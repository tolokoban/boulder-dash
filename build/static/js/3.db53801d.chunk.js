(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{41:function(w,r,e){},42:function(w,r,e){"use strict";function t(w,r){if(!(w instanceof r))throw new TypeError("Cannot call a class as a function")}function i(w,r){for(var e=0;e<r.length;e++){var t=r[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(w,t.key,t)}}function a(w,r,e){return r&&i(w.prototype,r),e&&i(w,e),w}e.r(r);var n=function(){function w(r){t(this,w),this._levelDef=null,this._levelDef=r,this.parseLevelDef(r)}return a(w,[{key:"clone",value:function(){return new w(this._levelDef)}},{key:"index",value:function(w,r){return 6*(r*this.cols+w)}},{key:"move",value:function(r,e,t,i){var a=this.index(r,e),n=this.index(t,i),d=this.data,s=d[a];s!==w.VOID&&(d[n+0]=s,d[n+5]=d[a+5],d[a+0]=w.VOID,s===w.ROCK||s===w.DIAM?(d[n+3]=d[a+3],d[n+4]=d[a+4]):(d[n+3]=0,d[n+4]=0),d[a+3]=0,d[a+4]=0)}},{key:"getType",value:function(w,r){return this.data[this.index(w,r)+0]}},{key:"setType",value:function(w,r,e){this.data[this.index(w,r)+0]=e}},{key:"getX",value:function(w,r){return this.data[this.index(w,r)+1]}},{key:"setX",value:function(w,r,e){this.data[this.index(w,r)+1]=e}},{key:"getY",value:function(w,r){return this.data[this.index(w,r)+2]}},{key:"setY",value:function(w,r,e){this.data[this.index(w,r)+2]=e}},{key:"getVX",value:function(w,r){return this.data[this.index(w,r)+3]}},{key:"setVX",value:function(w,r,e){this.data[this.index(w,r)+3]=e}},{key:"getVY",value:function(w,r){return this.data[this.index(w,r)+4]}},{key:"setVY",value:function(w,r,e){this.data[this.index(w,r)+4]=e}},{key:"setMove",value:function(w,r,e,t){var i=this.index(w,r);this.data[i+3]=e,this.data[i+4]=t}},{key:"getIndex",value:function(w,r){return this.data[this.index(w,r)+5]}},{key:"setIndex",value:function(w,r,e){this.data[this.index(w,r)+5]=e}},{key:"hasFlag",value:function(w,r){var e=this.cols*r+w;return this._flags[e]}},{key:"flag",value:function(w,r){var e=this.cols*r+w;this._flags[e]=1}},{key:"unflag",value:function(w,r){var e=this.cols*r+w;this._flags[e]=0}},{key:"parseLevelDef",value:function(w){var r,e,t,i,a=w.rows,n=[],s=[];return a.forEach(function(w,a){for(var d=0;d<w.length;d++){s.push(0);var o=0,u=0;switch(w.charAt(d)){case" ":o=0;break;case"w":o=1;break;case".":o=3;break;case"r":o=4,u=Math.floor(16*Math.random());break;case"d":o=5,u=Math.floor(16*Math.random());break;case"E":o=2,r=d,e=a;break;case"X":o=1,t=d,i=a;break;case"*":o=7;break;case"@":o=9}n.push(o,d,a,0,0,u)}}),this._flags=s,this.heroX=r,this.heroY=e,Object.defineProperty(this,"heroVX",{get:function(){return this.data[this.index(this.heroX,this.heroY)+3]},set:function(w){this.data[this.index(this.heroX,this.heroY)+3]=w}}),Object.defineProperty(this,"heroVY",{get:function(){return this.data[this.index(this.heroX,this.heroY)+4]},set:function(w){this.data[this.index(this.heroX,this.heroY)+4]=w}}),Object.defineProperty(this,"heroIndex",{get:function(){return this.data[this.index(this.heroX,this.heroY)+5]},set:function(w){this.data[this.index(this.heroX,this.heroY)+5]=w}}),d(this,"data",new Float32Array(n)),d(this,"need",w.need),d(this,"tint",w.tint||{}),d(this,"rows",a.length),d(this,"cols",a[0].length),d(this,"exitX",t),d(this,"exitY",i),console.info("[level] cols, rows, data=",this.cols,this.rows,n),n}}]),w}();function d(w,r,e){Object.defineProperty(w,r,{value:e,writable:!1,enumarable:!0,configurable:!1})}n.VOID=0,n.WALL=1,n.HERO=2,n.DUST=3,n.ROCK=4,n.DIAM=5,n.EXIT=6,n.EXP1=7,n.EXP2=8,n.MONS=9,n.BOOM=99;var s=[{need:12,rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","w...... ..d.r .....r.r....... ....r....w","w.rEr...... .........rd..r.... ..... ..w","w.......... ..r.....r.r..r........r....w","wr.rr.........r......r..r....r...r.....w","wr. r......... r..r........r......r.rr.w","w... ..r........r.....r. r........r.rr.w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwww...r..r.w","w. ...r..d. ..r.r..........d.rd...... .w","w..d.....r..... ........rr r..r....r...w","w...r..r.r..............r .r..r........w","w.r.....r........rrr.......r.. .d....r.w","w.d.. ..r.  .....r.rd..d....r...r..d. .w","w. r..............r r..r........d.....rw","w........wwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","w r.........r...d....r.....r...r.......w","w r......... r..r........r......r.rr..Xw","w. ..r........r.....r.  ....d...r.rr...w","w....rd..r........r......r.rd......r...w","w... ..r. ..r.rr.........r.rd...... ..rw","w.d.... ..... ......... .r..r....r...r.w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:11,tint:{wall:280,rock:280,diam:45,dust:280,expl:0,mons:0,void:285},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","w.r..r..w.r...d.w... .r.wr......w..rr..w","w.......w......rwrr. ...w ..d...w....r.w","w                                      w","wd......w.r....rw.r. .. w..r..d.w..r.r.w","w.......w.r....rw.r. r..w.....r.w... ..w","wwwwwwwwwwwwwwwwwwww wwwwwwwwwwwwwwwwwww","w....rr.w..r....w... ..rw....r..w.....rw","w.......w.. ....w... ...w....r. w.....rw","w                                      w","wr..r...w....r..w..r ...w......dwr.....w","wr....r.w..r..r.w... . rw.......wr...r.w","w.r.....w...r...w... . rw.......w r..r.w","wwwwwwwwwwwwwwwwwwww wwwwwwwwwwwwwwwwwww","wr.  @..w....r.rw... ...w.rd..r.w......w","w.....r.wr......w..d ...w ..r...w.r.rr.w","w                                      w","wd.. .r.wr....r.w.r. ..rw.r.r...w......w","w.....r.wr..d...w... r..w..r....w...rr w","w.d... rw..r....w.Ed r..w. .....w...rr w","w.r.... w.. ..r.w.X.r...w....r.rw.... .w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:23,tint:{wall:120,rock:80,diam:180,dust:330,expl:0,mons:0,void:210},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wr.ww.wrr.w...rwr..r....w...r.....rw.d.w","w..Ew.d.r.w...www..w.r....r..r.r...w.wrw","w....w..rd..r....w.....r.wwr.......w.www","wd.w..wrwr..r....w...r......r.rr......ww","wr.w...w..r.ww..r.wwd.......r.rr......ww","wrr..r....w...r......r.rr......r..dww..w","w..r.ww..r.rr...w....r.rr......w..r.w.rw","w..w...d......d.r..wwr..r.w.wr..wr..d.rw","wr.r....w.ww..d.r..wwr..r..d.w...w..r.ww","w.r.ww.....rrwr..d.w.wr..wr...wr..d.r..w","ww.ww......rrwr..r.w.ww...w..r.ww..r.www","w.w.r.r.w...wwr..r....w...r.....ww.r.www","w.w.r.r.w.d.w.wr..wr....r..r.rr....w...w","ww..wrwr..r....w...d...w.rw......w.ww.dw","ww...wwr..w.d...wr..r.r...r.wr......w..w","ww.d....r.ww..r.wwr.......r.wr......w..w","w..r....w...r......r.rr......w..r.w...ww","wr.ww..r.ww...w....r.rr......w..rd..r..X","ww...r......r.rd......r...ww..wr..d.w..w","wrr...w.....r.rd......w..r.wd.d.rw.r...w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:20,tint:{wall:200,rock:280,diam:200,dust:240,expl:0,mons:60,void:200},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wE.....r....................r........r.w","w.....r..............r.................w","w........r..r..........................w","wr.....................................w","w...................r..................w","w.r.....................r.........r....w","w..r.....r...........r..r.............rw","w......r......r.....................r..w","w........ @...r.. @...... @...... @....w","w........  ...r..  ......  ......  .r..w","w......................................w","w...r..............................r...w","w...r.....r............................w","w......r...........r..................rw","w...........r.......r..................w","w..r..............r....................w","w.....................r.........r......w","w................................r..r..w","w....r......r.rr..................r....w","w...........r.rr.........r..r.r.......Xw","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:1,tint:{wall:100,rock:20,diam:100,dust:0,expl:0,mons:240,void:100},rows:["wwwwwwwwwwwwwwwwwwww","w                  w","w         r        w","w E       .        w","w                 @w","w                  w","w                  w","w                  w","w                  w","w                  w","w                 Xw","wwwwwwwwwwwwwwwwwwww"]},{need:70,tint:{wall:30,rock:90,diam:120,dust:300,expl:0,mons:140,void:300},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wE.....................................w","w......................................w","w......................................w","w......................................w","w......................................w","w......................................w","w......................................w","w.......  @.....  @.....  @.....  @....w","w.......   .....   .....   .....   ....w","w....... d ..... d ..... d ..... d ....w","w......................................w","w......................................w","w......................................w","w.......  @.....  @.....  @.....  @....w","w.......   .....   .....   .....   ....w","w....... d ..... d ..... d ..... d ....w","w......................................w","w......................................w","w......................................w","w......................................X","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:40,tint:{wall:300,rock:210,diam:300,dust:200,expl:0,mons:140,void:300},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wwwwwwwwww....r.r..r........r.wwwwwwwwww","ww        ...........r....r...        ww","ww@d      ..r..........r...r..      d@ww","wwwwwwwwww..r........r......r.wwwwwwwwww","ww        ......r...r.......r.        ww","ww@d      ....r......r.rr.....      d@ww","wwwwwwwwww.rr........r.rr.....wwwwwwwwww","ww        ....r.r....r..r.....        ww","ww@d      ....r.r....r..r..r..      d@ww","wwwwwwwwww.rr.r..r....r...r...wwwwwwwwww","ww        .rr.r..r............        ww","ww@d      ....r..r........r...      d@ww","wwwwwwwwww.....r...r....r..r..wwwwwwwwww","w....r.r..r........r.....r............rw","w......r....r....r..r.r...r..r.........w","w..r....r.....r...r.......r..r.........w","w..r........r......r.rr.........r......w","wr.E...r...........r.rr.........rr..r.Xw","w....r......r.rr......r........r..r....w","wrr.........r.rr.........r..r.r.r..r...w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:13,tint:{wall:30,rock:10,diam:80,dust:100,expl:0,mons:300,void:100},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","w. .. .rr..... ..r. E.... rr r..r. .  .w","w ..r. .. .  .... .r.r. ...  r..r.d.. .w","wr.....  .@.  ... .r.r. ... wwwwwwwwwwww","w.r.d... .  ...... ..rr..r.... . ... . w","wwwwwwwwwwwww.r. ..   r.. .... ...r....X","wr. r...... ..r. ... ..r.  ..r.  @.....w","wr. r...... .. r..r.... ...r......r.rr.w","w... ..r  ... ..r.  ..r.  ... ....r.rr.w","w... ..r. .r.... ...@......r.r..  r..r.w","w  .. r.... ..r.r.... .  .......  d.. .w","w. ... .. .  .. .  .....rr r..r. . r.. w","w.. d..r.r.... .  ......r  r..r. .  ...w","w.r.  ..r.  ... .r.r. ...  r.. .... ...w","w....  .r.  ... .r.r. .r. . r.. r.... .w","w.  .... ....  .. r r..r.... ...r... .rw","w..... .  .rr. ...  r.. .r... r..r.r...w","w r...... ..r. .r.... .  ..r.  r.......w","w r...... .. r..r.... ...r......r.rr...w","w. ..r. ... ..r.  .aa.  ... ....r.rr...w","w. .dr@..r.... ...r......r.r@.....dr...w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:42,tint:{wall:30,rock:10,diam:20,dust:130,expl:0,mons:130,void:160},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","w . r.. . .. ..r. ..E ..r.  ..r. r... .w","w.r.rr...... ..r...r.... ...r.....dr.r.w","X r..r...  ...r..r. ..r.r...wwwwwwwwwwww","w...d ..r. @.....r..... ........rr r..rw","wwwwwwwwwwwww..r.r.... .  ......r  r..rw","w.  ... ..r.  ..r.  .... rrr.....  r.. w","w... r... @.. ..r.  .....r.rr..r. . r..w","w..r. ..r. r.... ..... ...r r..r.... ..w","w.....r ...... .  @rr. ...  r.. .r....rw","wr.r... . r...... ..r...r....r....dr.  w","w......r. r......... r..r...wwwwwwwwwwww","w.rr...... ..r. ...d..r.  ..r.  ... r..w","wwwwwwwwwwwwwr........ ...r......r.rr..w","w..r...  ...d..r. ..r.rr.........r.rr..w","w.. ..r. .r...@@@@@@@@.........  r..r..w","wr.. r....r..r r...d .. .......  r..r..w","w ... ..r. ...r.  .....rrrr..r. . r.. rw","w. r..@.r.... .  ......rr r..r...  ...rw","wr.  ..r.  .....r.r. ...  r..r.... ...rw","w...  .r.r .....r.r.....   .. .r....r..w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:16,tint:{wall:180,rock:239,diam:45,dust:245,expl:320,mons:357,void:133},rows:["wwwwwwwwwwwwwwwwwwww","wr@...............rw","wEr@.............rXw","wd.r@...........r.dw","wrd.r@.........r.drw","w.rd.r@.......r.dr.w","w..rd.r@.....r.dr..w","w...rd.r@...r.dr...w","w....rd.r@.r.dr....w","w.....rd.rr.dr.....w","w......rd..dr......w","wwwwwwwwwwwwwwwwwwww"]},{need:50,tint:{wall:26,rock:71,diam:264,dust:247,expl:56,mons:275,void:120},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wdddrrddrddr.rrrrdrdd.ddrddrddddrrdrdrrw","wdrrdddrdddrdddrrrrrdrrd.drdrrrrdrddrrdw","wddrrrrrdddrddrd.rrrdrrdddrdr.rrdrrrddrw","wrrdrddrrdrrrddrddd..ddrrdrddrrdrdd.rrdw","wrrdrddrrrrrrddrd.drdrrrrdrdrdrrddrrdrdw","wdddrrdrd.ddrrddrrdddrrdrdrrr.drddrrdrdw","wrrrrrdrrdddd..rrrdrdd.rdrddr.rrddddddrw","wdrddwwwwwww.wwwwwdrrrrdrwwwwww.wwwwwwrw","wd.ddw           wrddrrrdw           wrw","wdrdrw EX        wrddrrrdw           wrw","wdrrdw           wr.rrddrw           wrw","wdrrdw           wddddrdrw           wdw","wrdddw           wdrrd.drw           wdw","wrrrrw           wdrrddrrw           wrw","wdrddw           w.rdrrdrw           wrw","wdrddw           wwwwwwwww           wrw","wrrrdw                               wrw","wrrrdw           wdd.rdrdw           wrw","wddrrw           wrrrdrddw           wrw","wdd..wwwwwwwwwwwwwdrrrdddwwwwwwwwwwwwwdw","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:16,tint:{wall:33,rock:216,diam:73,dust:82,expl:92,mons:189,void:276},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","w............E.........................w","wwwwwwwwwwwww wwwwwwww.................w","ww....d.............dw.................w","ww.w w.wwwwww wwwwww.w.................w","ww.w@w.wd.........dw.w.................w","ww.w@w.w.wwww wwww.w.w.................w","ww.w@w.w.wd.....dw.w.w.................w","ww.w@w.w.w.ww ww.w.w.w.................w","ww.w@w w w w   w w w w.................w","ww.w@w@w@w@w@@@w@w@w@w.................w","ww.w@w w w w   w w w w.................w","ww.w@w.w.w.wwwww.w.w.w.................w","ww.w@w.w.wd.....dw.w.w.................w","ww.wdw.w.wwwwwwwww.w.w.................w","ww.wdw.wd.........dw.w.................w","ww.wdw.wwwwwwwwwwwww.w.................w","ww.wdwd.............dw.................w","wwwwwwwwwwwwwwwwwwwwww.................w","w......................................w","wX.....................................w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:6,tint:{wall:161,rock:339,diam:235,dust:70,expl:140,mons:135,void:303},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wr.rd.rrr.w...drr..rw...d...r.w...dr.r.w","w... .r.r.w...r r..rwr....r..rwr...r.rrw","w.... ..rrw.r....r..w..r. rr..w....r.rrw","wr.r.. rrrw.r.... ..wr......r.wr......rw","wr. ...r..w.  ..r.rrw.......r.wr...... w","wrr..r....w...r.....wr.rr.....wr..r r..w","w..r.rr..rwrr...r...wr.rr.....wr..r. .ww","w..r...r..w...r.r..rwr..r. .rrw. r..@wrw","wr.r.wwwwwwwww@wwwwwwwwwrwwwwwwwww..w. w","w.r.  .....rrrr..r.r.rr..rr... r..rwr..w","wr.rr......rrrr..r. . r...r..r.rr.wr.rrw","w. .r.r. w..rrr..r.... ...r.....rw.r.rrw","w. .r.r. wr.wwwwwwwwwwwwwwwwwrr.w..r...w","wr.. rrr.wr....r...r... .rr....w.r.rr.rw","wr...rrr.wr.r... r..r.r...r.rrw.....r.Xw","w .r....rw  ..r.rrr.......r.rw...... ..w","w..r.... w..r......r.rr.....wr..r.r...rw","wr.rr..r.wr...r....rErr......r..r@..r..w","wr...r...w..r.r@......r... r.. r..rdr..w","wrr.d. ..w..r.rr......r..r. r.@.rr.r...w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:22,tint:{wall:99,rock:91,diam:112,dust:72,expl:71,mons:192,void:220},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wr. ...rr.....r.r..r........r.....r..d.w","w.....d.r....... ....r....r..r..... ..rw","w.......rdw.r.w.. w...wr...r... @.. .. w","wdwwwwwwwwwww.w...w..rw.....r..  ......w","wr........w...w.r.w d.w.....r..........w","wrr..r....w...w...w..rwrr......r..d....w","w..r.....rwrr.w...w..rwrr.........r...rw","w.wwwwwwwwwww.w.r.w .rw.r....r. @...d.rw","wr.r......w...w.r.w..rw.r..d...  ...r..w","w.r.......wrr w..dw.. w...r.......d.r..w","w ........wrr w..rw...w... ..r.....r...w","w.wwwwwwwwwwwwwwwrw...w...r........r.  w","w...r.r...w...wr..wr..w.r..r.r. @......w","w....r r..w...w...wd..w..r ....  .....dw","w.... .r..w.d.w..rw.r.w...r. r.........w","w.wwwwwwwwwww.w...w...w...r. r.........w","w..r......w.r.w...wr.rw...... ..r......w","wr.E...r. w...w...wr.rw.........rd..r..w","w....r....w.r.wd..w...w.... ...r..d. ..X","wrr.......w.r.wd..w...w..r..d.d.r..r...w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:14,tint:{wall:166,rock:95,diam:98,dust:46,expl:293,mons:329,void:21},rows:["wwwwwwwwwwwwwwwwwwww","w       E          w","w                  w","w                  w","w                  w","w                 Xw","w                  w","w              @@@@w","w              @@@@w","w              @@@@w","wdddddddddddddd@@@@w","wwwwwwwwwwwwwwwwwwww"]},{need:10,tint:{wall:105,rock:55,diam:192,dust:74,expl:53,mons:142,void:169},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wr.....rr.X.....r.Era.......r........r.w","w.....r.r............r....r..r.r.......w","w........r..r..............r...........w","wr.......r...........r......r..r.......w","wr........r.....r...r.......r..r.......w","w.r..r........r......r.rr.........r....w","w..r.....r...........r.rr.........r...rw","w......r......r.r....r..r........r..r..w","wr.r..........r.r..........r...........w","w..........rr.r..r....r...r....r..r.r..w","w..........r..r..r...........r.....r...w","w...r.r.......r...........r........r...w","w...r.r...r....r...r.......r...........w","w....r.r..r........r.....r............rw","w......r....r....r..r.r......r.........w","w..r.wwwwwwwwwwwwwwwwwwwwwwwwwwwwww....w","w..r.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@....w","wr...rrrrrrrrrrrrrrrrrrrrrrrrrrrrrr.r..w","w......................................w","w.r................................r...w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:50,tint:{wall:165,rock:0,diam:252,dust:134,expl:113,mons:72,void:229},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","w..E...................................w","w......................................w","w......................................w","w......................................w","w.....................@.@.@.@.@.@......w","w.....................r.r.r.r.r.r......w","w......................................w","w......................................w","w.........@. . . . . ..................w","w......... . . . . . ..................w","w......... .@. . . . ..................w","w......... . . . . . ..................w","w......... . .@. . . ..................w","w......... . . . . . ..................w","w......... . . .@. . ..................w","w......... . . . . . ..................w","w......... . . . .@. ..................X","w......... . . . . . ..................w","w......... . . . . .@..................w","w......................................w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:32,tint:{wall:0,rock:320,diam:35,dust:300,expl:113,mons:202,void:0},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wr.rr..  r..r..r.r..Er..r.rr..r.rr...r.w","w.w.rr......r..r...r....w...r......r.r.w","wrrw.r... r.. r..r.r..rwr.... .. ..r.r@w","w...wr..r. @.....r. ..wr.  .....rrrr..rw","w.rr.wrr... r..r.r...wr. r......rrrr..rw","w. r..wr..r.r ..r.rrw... rrr. ...rrr..rw","w...rr.w.@ ..r..r.rw.....r.rr..r.r.rr..w","w..r.r..w.rr.... .w...r.. rrr..r....r..w","w... .rr.w....r. w@rr. ...rrr..r.r... rw","wr.r...r.rw.....wr..r. .r....r.  ..r.rrw","w......r.rrw...w. ..rr..r.... ...r.....w","w.rr......r....r...r..r.r ..r.rr... r..w","w.rr......r.@@@..r....r...r......r.rr..w","w..r... r...r..r.r..r.rr... .....r.rr..w","w..r..r. .r....r.....r.  ......rrr..r. w","wr.. r....r..r.r....r.  .......rrr..r..w","wr...r..r.  ..r.  .... rrrr..r.r.rr..rrw","w. r..@ r....r.rr......rrrr..r. .rr.. rw","wr.rr..r.rr... .r.r. ...rrr..r.... ...rw","w...rr.r.rr... .r.r.X...r r..r.r....r..w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:30,tint:{wall:100,rock:120,diam:235,dust:20,expl:313,mons:102,void:200},rows:["wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww","wE..r..........r........r.....r..r.....w","w.r.rr.........r...r........r......r.r.X","w.r..r........r..r....r.r..........r.rrw","w.......r..r.....r..............rr.r..rw","w..r...r....r..r.r..............r..r..rw","w.........r.....r........rrr.......r...w","w....r....r.....r........r.rr..r....r..w","w..r...@@@@@@..@@@@@@.....r.r..r.......w","w.....rw....w..w..rrw.......r....r....rw","wr.r...w..r.w..w....w...r....r.....r...w","w......w..r.w..w....wr..r........r.....w","w.rr...w....wr.w....w.r.....r.......r..w","w.rr...w....wrrw.r..w.....r......r.rr..w","w..r...w....w..w....w.rr.........r.rr..w","w.....rwwwwww..wwwwww............r..r..w","wr...r....r..r.r.................r..r..w","w.............r........r.....r........rw","w..r..r. @...... @.....r. @..r... @...rw","wr.....r  ......  .......  ..r...  ...rw","w......r.......................r....r..w","wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww"]},{need:18,tint:{wall:320,rock:70,diam:70,dust:70,expl:70,mons:70,void:70},rows:["wwwwwwwwwwwwwwwwwwwww","w..E.......rrr......w","w..........rrr......w","w...................w","w..........@@@......w","w.......r..   ......w","w........r.   ......w","w.........r   ......w","w........X.@@@......w","w..........   ......w","w..........   ......w","wwwwwwwwwwwwwwwwwwwww"]},{need:2,tint:{wall:120,rock:80,diam:180,dust:330,expl:0,mons:0,void:210},rows:["wwwwwww","wEddXw","wwwwwww"]}],o=[["Daisy",17132],["John",16e3],["Samantha",11728],["Henry",8226],["Virginia",4100],["William",1950],["Natalia",900],["Paul",650]];function u(w){window.localStorage.setItem("boulder-dash/scores",JSON.stringify(w))}var l=function(){function w(){t(this,w),this._scores=function(){var w=window.localStorage.getItem("boulder-dash/scores");if(!w)return o;try{if(w=JSON.parse(w),!Array.isArray(w))return o}catch(r){return console.error(r),o}return w}(),this._lastNewHighScore=-1}return a(w,[{key:"getScores",value:function(){return this._scores.slice()}},{key:"getLastHighScoreIndex",value:function(){return this._lastNewHighScore}},{key:"isAnHighScore",value:function(w){return w>this._scores[this._scores.length-1][1]}},{key:"addScore",value:function(w,r){for(var e=this._scores,t=0;t<e.length;t++)if(r>e[t][1]){for(this._lastNewHighScore=t,e.splice(t,0,[w,r]);e.length>8;)e.pop();return u(e),!0}return!1}}]),w}(),c=e(1),h=function(){function w(r,e){t(this,w);var i=this.createData();this._buffVert=c.a.fillArrayBuffer(r,i),this._prg=new c.a.Program(r,{vert:e.transitionVert,frag:e.transitionFrag}),this._gl=r,this._mode=0}return a(w,[{key:"createData",value:function(){var w,r,e=[],t=Math.sqrt(3),i=t/8;for(w=0;w<4;w++)r=t*(.5+w)/4,e.push(r,-i,-10,r,-i,10,r,+i,10,r,+i,10,r,+i,-10,r,-i,-10),e.push(-r,-i,-10,-r,-i,10,-r,+i,10,-r,+i,10,-r,+i,-10,-r,-i,-10);return this._count=48,new Float32Array(e)}},{key:"draw",value:function(w,r,e){var t=1;switch(this._mode){case 0:return;case 1:return this._time=w,void(this._mode=2);case 2:(w=(w-this._time)/this._duration)>1&&(w=1,this._mode=3);break;case 3:"function"===typeof this._action&&this._action(),this._time=w,this._mode=4,w=1;break;case 4:(w=1-(w-this._time)/this._duration)<0?(this._mode=0,w=0):t=-1}var i=this._gl,a=this._prg;a.use(),a.$uniDir=t,a.$uniTime=w,a.$uniWidth=r,a.$uniHeight=e,a.bindAttribs(this._buffVert,"attCenterX","attX","attY"),i.drawArrays(i.TRIANGLES,0,this._count)}},{key:"start",value:function(w,r){this._action=w,this._duration=r,this._mode=1}}]),w}(),f=[0,0,0,0,0,0,0];document.addEventListener("keydown",function(w){var r=!0;switch(w.key.toLowerCase()){case"arrowup":f[1]=1;break;case"arrowright":f[2]=1;break;case"arrowdown":f[3]=1;break;case"arrowleft":f[4]=1;break;case"escape":f[5]=1;break;case"space":f[6]=1;break;default:r=!1}r&&w.preventDefault()},!0),document.addEventListener("keyup",function(w){switch(w.key.toLowerCase()){case"arrowup":f[1]=0;break;case"arrowright":f[2]=0;break;case"arrowdown":f[3]=0;break;case"arrowleft":f[4]=0;break;case"escape":f[5]=0;break;case"space":f[6]=0}},!0);var v=null;window.addEventListener("gamepadconnected",function(w){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",w.gamepad.index,w.gamepad.id,w.gamepad.buttons.length,w.gamepad.axes.length),v=w.gamepad}),window.addEventListener("gamepaddisconnected",function(w){w.gamepad===v&&(v=null)});var T,E,m=null;document.addEventListener("touchstart",function(w){if(!m){var r=w.changedTouches[0];m=r.identifier,T=r.clientX,E=r.clientY,f[0]=f[1]=f[2]=f[3]=f[4]=f[5]=0,T<screen.width/2?"H":"V"}}),document.addEventListener("touchmove",function(w){var r=w.changedTouches[0];if(r.identifier===m){var e=r.clientX-T,t=r.clientY-E;T+=e,E+=t,Math.abs(e)<Math.abs(t)?(f[4]=f[2]=0,t>1?(f[3]=1,f[1]=0):t<-1&&(f[3]=0,f[1]=1)):(f[1]=f[3]=0,e>1?(f[2]=1,f[4]=0):e<-1&&(f[2]=0,f[4]=1))}});var g={STILL:0,UP:1,RIGHT:2,DOWN:3,LEFT:4,SUICIDE:5,START:6};Object.defineProperty(g,"action",{get:function(){if(v){for(var w=v.axes,r=0,e=Math.abs(w[0]),t=1;t<w.length;t++){var i=Math.abs(w[t]);i>e&&(r=t,e=i)}if(e>.4)return(e=w[r])>0?r%2===0?2:3:r%2===0?4:1;var a=-1;if(v.buttons.forEach(function(w,r){w.pressed&&(a=r)}),a>-1)return a<4?5:6}return f[1]?1:f[2]?2:f[3]?3:f[4]?4:f[5]?5:0}});var _=g,x=(e(41),{show:function(w){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=document.createElement("div");e.className="message";var t=document.createElement("div");r&&(t.style.color="#0f3"),t.textContent=w,e.appendChild(t),document.body.appendChild(e),setTimeout(function(){e.classList.add("show"),setTimeout(function(){e.classList.add("hide"),setTimeout(function(){document.body.removeChild(e)},300)},1300)})}}),p={createEnv:function(w,r){return{gl:w,assets:r,x:0,y:0,z:0,w:1,cellTime:150,nextSynchro:-1,levelNumber:0,score:0,bonus:0,divDiam:document.getElementById("diam"),divScore:document.getElementById("score"),eatenDiams:0,eatDiam:function(){r.diamSound.pause(),r.diamSound.currentTime=0,r.diamSound.play(),this.eatenDiams++,console.log(this.eatenDiams,"/",this.level.need),this.eatenDiams==this.level.need&&(this.level.setType(this.level.exitX,this.level.exitY,n.EXIT),r.exitSound.play()),this.score+=50,this.divDiam&&(this.divDiam.textContent=Math.max(0,this.level.need-this.eatenDiams),this.divScore.textContent=this.score)},playBoom:function(){r.rockSound.pause(),r.rockSound.currentTime=0,r.rockSound.play()},explode:function(w,e,t){var i,a,d=this.level;for(this.makeDiams=t,a=e-1;a<e+2;a++)for(i=w-1;i<w+2;i++)d.getType(i,a)!==n.WALL&&d.getType(i,a)!==n.EXIT&&(d.setType(i,a,t?n.EXP2:n.EXP1),d.setIndex(i,a,1),d.setMove(i,a,0,0));r.explSound.pause(),r.explSound.currentTime=0,r.explSound.play()},isHeroAlive:!0,killHero:function(){if(this.isHeroAlive){var w,r;for(this.camVX=this.camVY=0,this.isHeroAlive=!1,r=0;r<this.level.rows;r++)for(w=0;w<this.level.cols;w++)this.level.getType(w,r)===n.HERO&&this.explode(w,r);this.wait=10,this.isLevelDone?x.show("Well done!",!0):x.show("Ouch!")}},isLevelDone:!1,nextLevel:function(){this.isLevelDone=!0,this.killHero()}}},apply:function(w){var r,e,t=w.level,i=!1;for(r=0;r<t.rows;r++)for(e=0;e<t.cols;e++)if(t.getType(e,r)===n.HERO&&(i=!0),t.hasFlag(e,r))t.unflag(e,r);else{var a=t.getVX(e,r),d=t.getVY(e,r);0==a&&0==d||(t.move(e,r,e+a,r+d),(a>0||d>0)&&t.flag(e+a,r+d))}i||w.killHero()},process:function(w,r){var e,t,i,a=[],d=w.level;for(e=0;e<d.rows;e++)for(t=0;t<d.cols;t++)d.hasFlag(t,e)?d.unflag(t,e):(i=d.getType(t,e))===n.ROCK||i===n.DIAM?X(d,t,e,w):d.getType(t,e)===n.HERO?U(w,d,t,e,a,r):i===n.MONS?k(w,d,t,e):i===n.EXP1?I(w,d,t,e):i===n.EXP2&&A(w,d,t,e);a.forEach(function(r){var e=r[0],t=r[1],i=d.getVX(e,t),a=d.getVY(e,t);e+=i,t+=a;var s=d.getType(e,t);s===n.DUST?d.setType(e,t,n.VOID):s===n.DIAM?(w.eatDiam(),d.setType(e,t,n.VOID)):s===n.EXIT?w.nextLevel():s!==n.VOID&&w.killHero()})}};function y(w,r,e){var t=w.getType(r,e);return t===n.ROCK||t===n.DIAM}function R(w,r,e,t,i){if(0!==e||0!==t){var a=i.level,d=a.getType(w,r);a.getType(w+e,r+t)===n.HERO?i.killHero():(a.setMove(w,r,e,t),a.setType(w+e,r+t,-d))}}function b(w,r,e,t,i){i===n.VOID?(w.setMove(r,e,0,1),w.setType(r,e+1,n.BOOM)):function(w,r,e){var t=w.getType(r,e);return t===n.ROCK||t===n.DIAM||t===n.WALL}(w,r,e+1)&&(y(w,r,e-1)||(w.getType(r+1,e)!=n.VOID||w.getType(r+1,e+1)!=n.VOID||y(w,r+1,e-1)?w.getType(r-1,e)!=n.VOID||w.getType(r-1,e+1)!=n.VOID||y(w,r-1,e-1)||(r<2||!y(w,r-2,e)||w.getVX(r-2,e)<1)&&w.setMove(r,e,-1,0):w.setMove(r,e,1,0)))}function X(w,r,e,t){w.setVX(r,e,0);var i=w.getType(r,e+1);0!=w.getVY(r,e)?function(w,r,e,t,i){i!==n.VOID?(w.setVY(r,e,0),i==n.ROCK||i==n.WALL||i==n.DUST?t.playBoom():i==n.HERO?t.killHero():i==n.MONS?(w.setType(r,e,n.VOID),t.explode(r,e+1,!0)):i==n.DIAM&&w.getType(r,e)===n.ROCK&&(w.setType(r,e,n.VOID),t.explode(r,e+1))):w.setType(r,e+1,n.BOOM)}(w,r,e,t,i):b(w,r,e,0,i)}function I(w,r,e,t){r.getIndex(e,t)>0?r.setIndex(e,t,r.getIndex(e,t)-1):r.setType(e,t,n.VOID)}function A(w,r,e,t){r.getIndex(e,t)>0?r.setIndex(e,t,r.getIndex(e,t)-1):(r.setType(e,t,n.DIAM),r.setIndex(e,t,Math.floor(16*Math.random())))}var D=[[0,-1],[1,0],[0,1],[-1,0]];function k(w,r,e,t){var i,a,d,s,o,u=r.getIndex(e,t);for(a=5;a>1;a--)switch(d=(o=D[i=(u+a)%4])[0],s=o[1],r.getType(e+d,t+s)){case n.VOID:return R(e,t,d,s,w),void r.setIndex(e,t,i);case n.HERO:return void w.killHero();case n.ROCK:case n.DIAM:if(0==i)return void w.explode(e,t,!0);break;case n.BOOM:return void w.explode(e,t,!0)}r.setMove(e,t,0,0)}function U(w,r,e,t,i,a){if(!w.isHeroAlive)return w.camX=0,void(w.camY=0);var d=!0,s=0,o=0;switch(a){case _.UP:s=0,o=-1;break;case _.RIGHT:s=1,o=0,r.setIndex(e,t,0);break;case _.DOWN:s=0,o=1;break;case _.LEFT:s=-1,o=0,r.setIndex(e,t,1);break;case _.SUICIDE:w.killHero(),d=!1;break;default:d=!1}if(d){var u=e+s,l=t+o,c=r.getType(u,l);if(c===n.WALL||c===n.HERO)return w.camX=e,w.camY=t,w.camVX=0,void(w.camVY=0);c===n.ROCK?(1===s&&r.getType(u+1,l)===n.VOID?(r.setVX(u,l,1),r.flag(u,l)):-1===s&&r.getType(u-1,l)===n.VOID&&r.setVX(u,l,-1),r.setMove(e,t,0,0),s=o=0):(i.push([e,t]),r.flag(u,l),r.setMove(e,t,s,o))}w.camX=e,w.camY=t,w.camVX=s,w.camVY=o}var P=function(){function w(r){t(this,w),this._env=r;var e=function(){var w,r,e,t=[];for(r=1;r>.5;r-=.05)for(e=2/r,w=0;w<50;w++)t.push(e*Math.random()-e/2,e*Math.random()-e/2,r,1/r,Math.random(),Math.random());return t}();console.info("[rain-painter] data=",e),this._count=e.length/6,this._buffVert=c.a.fillArrayBuffer(r.gl,new Float32Array(e)),this._prg=new c.a.Program(r.gl,{vert:r.assets.rainVert,frag:r.assets.rainFrag}),this._texture=function(w,r){var e=w.createTexture();return w.bindTexture(w.TEXTURE_2D,e),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,r),e}(r.gl,r.assets.diamTexture)}return a(w,[{key:"destroy",value:function(){var w=this._prg,r=w.gl;r.deleteTexture(this._texture),r.deleteBuffer(this._buffVert),w.destroy()}},{key:"update",value:function(){var w=this._env,r=w.gl;r.bindBuffer(r.ARRAY_BUFFER,this._buffVert),r.bufferData(r.ARRAY_BUFFER,w.level.data,r.STATIC_DRAW)}},{key:"draw",value:function(w){var r=w.gl,e=this._prg;e.use(),e.$uniTime=w.time,r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this._texture),e.$uniTexture=0,e.bindAttribs(this._buffVert,"attX","attY","attZ","attW","attSpeed","attIndex"),r.drawArrays(r.POINTS,0,this._count)}}]),w}();var S=function(){function w(r,e){t(this,w);var i=function(w){var r,e,t,i,a={},d=w.rows,s=w.cols,o=[],u=[];function l(w,r){var e=r+"-"+w,t=a[e];"undefined"===typeof t&&(t=Math.floor(o.length/2),o.push(w-.5,r-.5),a[e]=t),u.push(t)}for(e=0;e<d;e++)for(r=0;r<s;r++)if(w.getType(r,e)===n.WALL){var c=V(w,r,e),h=L(w,r,e);c>h?(t=c,i=1):(t=1,i=h),l(r,e),l(r+t,e),l(r+t,e+i),l(r,e),l(r,e+i),l(r+t,e+i),M(w,r,e,i,t)}return{vertex:o,element:u}}(r.level.clone()),a=i.vertex,d=i.element;this._count=d.length,this._buffVert=c.a.fillArrayBuffer(r.gl,new Float32Array(a)),this._buffElem=c.a.fillElementBuffer(r.gl,new Uint16Array(d)),this._prg=new c.a.Program(r.gl,{vert:r.assets.wallVert,frag:r.assets.wallFrag},{coords:r.assets.coordsVert}),this._texture=function(w,r){var e=w.createTexture();return w.bindTexture(w.TEXTURE_2D,e),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,r),e}(r.gl,e)}return a(w,[{key:"destroy",value:function(){var w=this._prg,r=w.gl;r.deleteTexture(this._texture),r.deleteBuffer(this._buffVert),r.deleteBuffer(this._buffElem),w.destroy()}},{key:"draw",value:function(w){var r=w.gl,e=this._prg;e.use(),e.$uniWidth=w.width,e.$uniHeight=w.height,e.$uniX=w.x,e.$uniY=w.y,e.$uniZ=w.z,e.$uniW=w.w,r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this._texture),e.$texture=0,e.bindAttribs(this._buffVert,"attX","attY"),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this._buffElem),r.drawElements(r.TRIANGLES,this._count,r.UNSIGNED_SHORT,0)}}]),w}();function V(w,r,e){var t=1;for(r++;r<w.cols&&w.getType(r,e)===n.WALL;)r++,t++;return t}function L(w,r,e){var t=1;for(e++;e<w.rows&&w.getType(r,e)===n.WALL;)e++,t++;return t}function M(w,r,e,t,i){var a,d;for(a=e;a<e+t;a++)for(d=r;d<r+i;d++)w.setType(d,a,n.VOID)}var O=function(){function w(r){t(this,w),this._env=r,this._count=r.level.data.length/6,this._buffVert=c.a.fillArrayBuffer(r.gl,r.level.data),this._prg=new c.a.Program(r.gl,{vert:r.assets.levelVert,frag:r.assets.levelFrag}),this._texture=function(w,r){var e=w.createTexture();return w.bindTexture(w.TEXTURE_2D,e),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,r),e}(r.gl,r.assets.levelTexture)}return a(w,[{key:"destroy",value:function(){var w=this._prg,r=w.gl;r.deleteTexture(this._texture),r.deleteBuffer(this._buffVert),w.destroy()}},{key:"update",value:function(){var w=this._env,r=w.gl;r.bindBuffer(r.ARRAY_BUFFER,this._buffVert),r.bufferData(r.ARRAY_BUFFER,w.level.data,r.STATIC_DRAW)}},{key:"draw",value:function(w){var r=w.gl,e=this._prg;e.use(),e.$uniTime=w.time,e.$uniWidth=w.width,e.$uniHeight=w.height,e.$uniX=w.x,e.$uniY=w.y,e.$uniZ=w.z,e.$uniW=w.w,e.$uniCellTime=w.cellTime,r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this._texture),e.$texture=0,e.bindAttribs(this._buffVert,"attType","attX","attY","attVX","attVY","attIndex"),r.drawArrays(r.POINTS,0,this._count)}}]),w}();var N=function(){function w(r,e){t(this,w);this._buffVert=c.a.fillArrayBuffer(r.gl,new Float32Array([-1,-1,1,-1,-1,1,1,1])),this._prg=new c.a.Program(r.gl,{vert:r.assets.backgroundVert,frag:r.assets.backgroundFrag},{coords:r.assets.coordsVert}),this._texture=function(w,r){var e=w.createTexture();return w.bindTexture(w.TEXTURE_2D,e),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.REPEAT),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR),w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,r),e}(r.gl,e)}return a(w,[{key:"destroy",value:function(){var w=this._prg,r=w.gl;r.deleteTexture(this._texture),r.deleteBuffer(this._buffVert),w.destroy()}},{key:"draw",value:function(w){var r=w.gl,e=this._prg;e.use(),e.$uniWidth=w.width,e.$uniHeight=w.height,e.$uniX=w.x,e.$uniY=w.y,e.$uniZ=w.z,e.$uniW=w.w,r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this._texture),e.$texture=0,e.bindAttribs(this._buffVert,"attX","attY"),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}]),w}();var B=function(){function w(r,e){t(this,w),this._prg=void 0,this._buffVert=void 0,this._texture=void 0,this._gl=void 0;var i=document.createElement("canvas"),a=i.getContext("webgl",{preserveDrawingBuffer:!0});this._prg=new c.a.Program(a,{vert:r,frag:e});this._buffVert=c.a.fillArrayBuffer(a,new Float32Array([0,0,1,0,0,1,1,1])),this._texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this._texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),this._canvas=i,this._gl=a}return a(w,[{key:"shiftHue",value:function(w,r){if("number"!==typeof r||isNaN(r))return w;var e=this._canvas,t=this._prg,i=this._gl;t.use();var a=w.width,n=w.height;e.setAttribute("width",a),e.setAttribute("height",n),i.viewport(0,0,a,n),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,w),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._texture),t.$uniTexture=0,t.$uniHueShift=r,t.bindAttribs(this._buffVert,"attX","attY"),i.drawArrays(i.TRIANGLE_STRIP,0,4);var d=document.createElement("canvas");d.setAttribute("width",a),d.setAttribute("height",n);var s=d.getContext("2d");return s.clearRect(0,0,a,n),s.drawImage(e,0,0,a,n),d}},{key:"destroy",value:function(){var w=this._prg,r=w.gl;r.deleteTexture(this._texture),r.deleteBuffer(this._buffVert),w.destroy()}}]),w}(),H=function(w,r){"undefined"===typeof r&&(r={});var e=document.createElement("canvas");e.setAttribute("width",1024),e.setAttribute("height",384);var t=e.getContext("2d"),i=new B(w.hueVert,w.hueFrag);t.drawImage(w.heroTexture,0,0),t.drawImage(i.shiftHue(w.boulderTexture,r.rock),0,64),t.drawImage(i.shiftHue(w.diamTexture,r.diam),0,128),t.drawImage(i.shiftHue(w.groundTexture,r.dust),0,192),t.drawImage(i.shiftHue(w.exitTexture,r.exit),80,192),t.drawImage(i.shiftHue(w.exploTexture,r.expl),512,192),t.drawImage(i.shiftHue(w.monsterTexture,r.mons),0,320),i.destroy(),t.scale(-1,1);for(var a=0;a<8;a++)t.drawImage(w.heroTexture,64*a,0,64,64,-576-64*a,0,64,64);return e};H.Tinter=B;var Y=H;function C(w,r){("number"!==typeof r||isNaN(r))&&(r=0),0===r&&(w.life=3,w.score=0),r%=s.length,w.backgroundPainter&&w.backgroundPainter.destroy(),w.wallPainter&&w.wallPainter.destroy(),w.levelPainter&&w.levelPainter.destroy();var e=new n(s[r]);console.info("[script] level.tint=",e.tint),w.assets.levelTexture=Y(w.assets,e.tint),w.level=e,w.camX=e.cols/2,w.camY=e.rows/2,w.camVX=0,w.camVY=0,w.eatenDiams=0,w.nextSynchro=-1,w.isHeroAlive=!0,w.isLevelDone=!1,w.bonus=e.cols*e.rows*4,w.wait=-1,w.levelNumber=r,w.assets.musicSound.pause(),w.assets.musicSound.currentTime=0,w.assets.musicSound.play();var t=new Y.Tinter(w.assets.hueVert,w.assets.hueFrag),i=w.assets.backgroundTexture;w.backgroundPainter=new N(w,t.shiftHue(i,e.tint.void));var a=w.assets.wallTexture;return w.wallPainter=new S(w,t.shiftHue(a,e.tint.wall)),w.levelPainter=new O(w),document.getElementById("diam").textContent=e.need,document.getElementById("life").textContent=w.life,document.getElementById("score").textContent=w.score,document.getElementById("bonus").textContent=w.bonus,e}function F(w,r){if(w.isAnHighScore(r)){var e=e;e.className="",divNewScore.textContent=""+r,divName.focus()}else G(w)}function G(w){var r=document.getElementById("highscores");r.innerHTML="",w.getScores().forEach(function(e,t){var i=e[0],a=e[1],n=document.createElement("div");r.appendChild(n),t==w.getLastHighScoreIndex()&&(n.className="highlighted");var d=document.createElement("div");d.textContent=i;var s=document.createElement("div");s.textContent=a,n.appendChild(d),n.appendChild(s)}),function(){var w=document.getElementById("welcome");w&&(w.className="")}()}function W(w,r){var e=document.getElementById(w);if(!e)throw Error('No element found with id="'.concat(w,'"!'));e.addEventListener("click",r)}function $(w){var r=document.getElementById(w);if(!r)throw Error('Unable to find element with id="'.concat(w,'"!'));return r}r.default={go:function(w){var r=$("name"),e=$("new-score"),t=$("congrat"),i=$("welcome"),a=$("bonus"),n=$("canvas"),d=n.getContext("webgl");if(d){var s=p.createEnv(d,w);console.info("env=",s),C(s,parseInt(location.search.substr(1))),d.clearColor(0,0,0,1),d.enable(d.DEPTH_TEST),d.clearDepth(0),d.depthFunc(d.GREATER);var o=new P(s),u=new h(d,w),c=new l;s.demoMode=!0,G(c);var f=function(){!function(){var w=document.getElementById("welcome");w&&(w.className="hide")}(),u.start(function(){s.demoMode=!1,C(s,parseInt(location.search.substr(1)))},1e3)};W("btnStart",f),W("btnOk",function(){var w=r.value.trim();if(0!==w.length){var i=parseInt(e.textContent);c.addScore(w,i),t.className="hide",G(c),s.demoMode=!0}else r.focus()}),window.requestAnimationFrame(function w(r){window.requestAnimationFrame(w);var e=_.action;s.demoMode&&(e===_.START&&("hide"!=t.className?f():"hide"!=i.className&&f()),e=_.STILL),s.time=r;var l=n.clientWidth,h=n.clientHeight;if(n.setAttribute("width",l),n.setAttribute("height",h),s.width=l,s.height=h,s.w=Math.min(l,h)<481?2:1,d.viewport(0,0,l,h),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),u.draw(r,l,h),s.demoMode)o.draw(s);else{s.nextSynchro<0?s.nextSynchro=Math.ceil(r/s.cellTime)*s.cellTime:r>=s.nextSynchro&&(s.nextSynchro=Math.ceil(r/s.cellTime)*s.cellTime,p.apply(s),p.process(s,e),s.levelPainter.update(),s.bonus--,0===s.bonus&&s.killHero(),a.textContent=s.bonus,s.wait>-1&&(s.wait--,s.wait<=0&&(s.isLevelDone?u.start(function(){s.score+=s.bonus,C(s,s.levelNumber+1)},1200):(s.life--,s.life<=0?(F(c,s.score),s.levelNumber=0,s.demoMode=!0):C(s,s.levelNumber)),s.wait=-1)));var v=r%s.cellTime/s.cellTime;64*s.level.cols/s.w<l?s.x=s.level.cols/2:s.x=Math.min(Math.max(s.camX+v*s.camVX,l*s.w*.5/64),s.level.cols-1-l*s.w*.5/64),64*s.level.rows/s.w<h?s.y=s.level.rows/2:s.y=Math.min(Math.max(s.camY+v*s.camVY,h*s.w*.5/64),s.level.rows-1-h*s.w*.5/64),s.levelPainter.draw(s),s.z=.2,s.wallPainter.draw(s),s.z=0,s.backgroundPainter.draw(s)}})}}}}}]);
//# sourceMappingURL=3.db53801d.chunk.js.map
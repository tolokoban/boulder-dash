{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","lib/level.ts","lib/levels.ts","lib/high-score.ts","lib/transition.ts","lib/game-inputs.ts","lib/message.ts","lib/level-logic.ts","lib/rain-painter.ts","lib/wall-painter.ts","lib/level-painter.ts","lib/background-painter.ts","lib/texture-aggregator.ts","lib/app.ts"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","Level","levelDef","this","_levelDef","parseLevelDef","col","row","cols","col1","row1","col2","row2","idx1","index","idx2","d","data","cell","VOID","ROCK","DIAM","value","x","y","vx","vy","idx","_flags","heroCol","heroRow","exitCol","exitRow","rows","flags","forEach","push","type","charAt","Math","floor","random","heroX","heroY","get","set","v","readonly","Float32Array","need","tint","console","info","obj","name","enumarable","WALL","HERO","DUST","EXIT","EXP1","EXP2","MONS","BOOM","Levels","wall","rock","diam","dust","expl","mons","void","DEFAULT_HIGH_SCORES","saveToLocalStorage","scores","window","localStorage","setItem","JSON","stringify","HighScore","_scores","getItem","parse","Array","isArray","ex","error","loadFromLocalStorage","_lastNewHighScore","slice","score","k","splice","pop","Transition","gl","assets","createData","_buffVert","WebGL","fillArrayBuffer","_prg","Program","vert","transitionVert","frag","transitionFrag","_gl","_mode","centerX","radius","sqrt","size","_count","time","width","height","dir","_time","_duration","_action","prg","use","$uniDir","$uniTime","$uniWidth","$uniHeight","bindAttribs","drawArrays","TRIANGLES","action","duration","state","document","addEventListener","evt","catchKey","toLowerCase","preventDefault","gamepad","e","log","id","buttons","axes","touchX","touchY","touchId","touch","changedTouches","identifier","clientX","clientY","screen","abs","context","STILL","UP","RIGHT","DOWN","LEFT","SUICIDE","START","pressedButtonIndex","button","pressed","lib_message","show","msg","isGoodNews","arguments","undefined","div","createElement","className","text","style","color","textContent","appendChild","body","setTimeout","classList","add","removeChild","level_logic","createEnv","z","w","cellTime","nextSynchro","levelNumber","bonus","divDiam","getElementById","divScore","eatenDiams","eatDiam","diamSound","pause","currentTime","play","level","setType","exitX","exitY","exitSound","max","playBoom","rockSound","explode","makeDiams","getType","setIndex","setMove","explSound","isHeroAlive","killHero","camVX","camVY","wait","isLevelDone","Message","nextLevel","apply","env","hasFlag","unflag","getVX","getVY","move","flag","process","heroMoves","processRockOrDiam","processHero","processMonster","processExplosion1","processExplosion2","isRockOrDiam","prepareMove","src","processSteadyRockOrDiam","below","isRockOrDiamOrWall","setVX","setVY","processFallingRockOrDiam","getIndex","dirs","camX","camY","GameInputs","nextX","nextY","RainPainter","_env","getData","rainVert","rainFrag","_texture","img","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","diamTexture","deleteTexture","deleteBuffer","destroy","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","activeTexture","TEXTURE0","$uniTexture","POINTS","WallPainter","wallTexture","arrays","ww","hh","cache","vertexArray","elementArray","addVertex","countRight","countWallToRight","countBottom","countWallToBottom","clear","vertex","element","getArrays","clone","_buffElem","fillElementBuffer","Uint16Array","wallVert","wallFrag","coords","coordsVert","REPEAT","$uniX","$uniY","$uniZ","$uniW","$texture","ELEMENT_ARRAY_BUFFER","drawElements","UNSIGNED_SHORT","count","cc","rr","LevelPainter","levelVert","levelFrag","NEAREST","levelTexture","$uniCellTime","BackgroundPainter","backgroundTexture","backgroundVert","backgroundFrag","TRIANGLE_STRIP","Tinter","canvas","getContext","preserveDrawingBuffer","_canvas","shift","isNaN","setAttribute","viewport","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","$uniHueShift","output","ctx","clearRect","drawImage","f","tinter","hueVert","hueFrag","heroTexture","shiftHue","boulderTexture","groundTexture","exitTexture","exit","exploTexture","monsterTexture","scale","initLevel","life","backgroundPainter","wallPainter","levelPainter","TextureAggregator","musicSound","addNewScore","highscore","isAnHighScore","divCongrat","divNewScore","divName","focus","refreshHighScores","innerHTML","getScores","item","pos","getLastHighScoreIndex","cell1","cell2","elem","showHighScores","onClick","handler","Error","concat","getById","__webpack_exports__","go","divWelcome","divBonus","LevelLogic","parseInt","location","search","substr","clearColor","enable","DEPTH_TEST","clearDepth","depthFunc","GREATER","rainPainter","transition","demoMode","onStart","hideHighScores","start","trim","newScore","addScore","requestAnimationFrame","anim","clientWidth","clientHeight","min","draw","ceil","update","t"],"mappings":"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","file":"static/js/3.db53801d.chunk.js","sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","const NB_ATTRIBS = 6;\n\nconst VOID = 0;\nconst WALL = 1;\nconst HERO = 2;\nconst DUST = 3;\nconst ROCK = 4;\nconst DIAM = 5;\nconst EXIT = 6;\nconst EXP1 = 7;\nconst EXP2 = 8;\nconst MONS = 9;\nconst BOOM = 99;\n\nexport default class Level {\n    _levelDef = null;\n\n    static VOID = VOID;\n    static WALL = WALL;\n    static HERO = HERO;\n    static DUST = DUST;\n    static ROCK = ROCK;\n    static DIAM = DIAM;\n    static EXIT = EXIT;\n    static EXP1 = EXP1;\n    static EXP2 = EXP2;\n    static MONS = MONS;\n    // Destination d'une pierre ou d'un diamant en chute.\n    static BOOM = BOOM;\n\n    constructor(levelDef) {\n        this._levelDef = levelDef;\n        this.parseLevelDef(levelDef);\n    }\n\n\n    clone() {\n        return new Level(this._levelDef);\n    }\n\n    index(col, row) {\n        return NB_ATTRIBS * (row * this.cols + col);\n    }\n\n    move(col1, row1, col2, row2) {\n        var idx1 = this.index(col1, row1);\n        var idx2 = this.index(col2, row2);\n        var d = this.data;\n        var cell = d[idx1];\n        if (cell === Level.VOID) return;\n        d[idx2 + 0] = cell;  // Type\n        d[idx2 + 5] = d[idx1 + 5];  // Index\n        d[idx1 + 0] = Level.VOID;\n        if (cell === Level.ROCK || cell === Level.DIAM) {\n            d[idx2 + 3] = d[idx1 + 3];  // VX\n            d[idx2 + 4] = d[idx1 + 4];  // VY\n        } else {\n            d[idx2 + 3] = 0;  // VX\n            d[idx2 + 4] = 0;  // VY\n        }\n        d[idx1 + 3] = 0;  // VX\n        d[idx1 + 4] = 0;  // VY\n    }\n\n    getType(col, row) {\n        return this.data[this.index(col, row) + 0];\n    }\n\n    setType(col, row, value) {\n        this.data[this.index(col, row) + 0] = value;\n    }\n\n    getX(col, row) {\n        return this.data[this.index(col, row) + 1];\n    }\n\n    setX(col, row, x) {\n        this.data[this.index(col, row) + 1] = x;\n    }\n\n    getY(col, row) {\n        return this.data[this.index(col, row) + 2];\n    }\n\n    setY(col, row, y) {\n        this.data[this.index(col, row) + 2] = y;\n    }\n\n    getVX(col, row) {\n        return this.data[this.index(col, row) + 3];\n    }\n\n    setVX(col, row, vx) {\n        this.data[this.index(col, row) + 3] = vx;\n    }\n\n    getVY(col, row) {\n        return this.data[this.index(col, row) + 4];\n    }\n\n    setVY(col, row, vy) {\n        this.data[this.index(col, row) + 4] = vy;\n    }\n\n    setMove(col, row, vx, vy) {\n        var idx = this.index(col, row);\n        this.data[idx + 3] = vx;\n        this.data[idx + 4] = vy;\n    }\n\n    getIndex(col, row) {\n        return this.data[this.index(col, row) + 5];\n    }\n\n    setIndex(col, row, value) {\n        this.data[this.index(col, row) + 5] = value;\n    }\n\n    /**\n     * Les flags sont des drapeaux que l'on met sur des cellules du tableau pour indiquer\n     */\n    hasFlag(col, row) {\n        var idx = this.cols * row + col;\n        return this._flags[idx];\n    }\n\n    flag(col, row) {\n        var idx = this.cols * row + col;\n        this._flags[idx] = 1;\n    }\n\n    unflag(col, row) {\n        var idx = this.cols * row + col;\n        this._flags[idx] = 0;\n    }\n\n    parseLevelDef(levelDef) {\n        var rows = levelDef.rows;\n        var data = [];\n        var diamCount = 0;\n        var heroCol, heroRow;\n        var exitCol, exitRow;\n        var flags = [];\n        rows.forEach(function(row, y) {\n            for (var x = 0; x < row.length; x++) {\n                flags.push(0);\n                var char = row.charAt(x);\n                var type = VOID;\n                var index = 0;\n                switch (char) {\n                    case ' ':\n                        type = VOID;\n                        break;\n                    case 'w':\n                        type = WALL;\n                        break;\n                    case '.':\n                        type = DUST;\n                        break;\n                    case 'r':\n                        type = ROCK;\n                        index = Math.floor(16 * Math.random());\n                        break;\n                    case 'd':\n                        type = DIAM;\n                        index = Math.floor(16 * Math.random());\n                        break;\n                    case 'E':\n                        type = HERO;\n                        heroCol = x;\n                        heroRow = y;\n                        break;\n                    case 'X':\n                        type = WALL;\n                        exitCol = x;\n                        exitRow = y;\n                        break;\n                    case '*':\n                        type = EXP1;\n                        break;\n                    case '@':\n                        type = MONS;\n                        break;\n                }\n                data.push(type, x, y, 0, 0, index);\n            }\n        });\n\n        this._flags = flags;\n        this.heroX = heroCol;\n        this.heroY = heroRow;\n        //#(heroVXY)\n        Object.defineProperty(this, \"heroVX\", {\n            get: function() {\n                return this.data[this.index(this.heroX, this.heroY) + 3];\n            },\n            set: function(v) {\n                this.data[this.index(this.heroX, this.heroY) + 3] = v;\n            }\n        });\n        Object.defineProperty(this, \"heroVY\", {\n            get: function() {\n                return this.data[this.index(this.heroX, this.heroY) + 4];\n            },\n            set: function(v) {\n                this.data[this.index(this.heroX, this.heroY) + 4] = v;\n            }\n        });\n        Object.defineProperty(this, \"heroIndex\", {\n            get: function() {\n                return this.data[this.index(this.heroX, this.heroY) + 5];\n            },\n            set: function(v) {\n                this.data[this.index(this.heroX, this.heroY) + 5] = v;\n            }\n        });\n        //#(heroVXY)\n        readonly(this, \"data\", new Float32Array(data));\n        readonly(this, \"need\", levelDef.need);\n        readonly(this, \"tint\", levelDef.tint || {});\n        readonly(this, \"rows\", rows.length);\n        readonly(this, \"cols\", rows[0].length);\n        readonly(this, \"exitX\", exitCol);\n        readonly(this, \"exitY\", exitRow);\n\n        console.info(\"[level] cols, rows, data=\", this.cols, this.rows, data);\n        return data;\n    }\n}\n\nfunction readonly(obj, name, value) {\n    Object.defineProperty(obj, name, {\n        value: value,\n        writable: false,\n        enumarable: true,\n        configurable: false\n    });\n}\n","/*\n *  Légende :\n *\n *  w: Mur\n *   : Vide\n *  .: Terre\n *  r: Pierre\n *  d: Diamant\n *  @: Monstre\n *\n *  E: Entrée\n *  X: Sortie\n */\n\nconst Levels=[\n    {\n      // Nombre de diamants nécessaire pour ouvrir la sortie.\n      need: 12,\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"w...... ..d.r .....r.r....... ....r....w\",\n        \"w.rEr...... .........rd..r.... ..... ..w\",\n        \"w.......... ..r.....r.r..r........r....w\",\n        \"wr.rr.........r......r..r....r...r.....w\",\n        \"wr. r......... r..r........r......r.rr.w\",\n        \"w... ..r........r.....r. r........r.rr.w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwww...r..r.w\",\n        \"w. ...r..d. ..r.r..........d.rd...... .w\",\n        \"w..d.....r..... ........rr r..r....r...w\",\n        \"w...r..r.r..............r .r..r........w\",\n        \"w.r.....r........rrr.......r.. .d....r.w\",\n        \"w.d.. ..r.  .....r.rd..d....r...r..d. .w\",\n        \"w. r..............r r..r........d.....rw\",\n        \"w........wwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"w r.........r...d....r.....r...r.......w\",\n        \"w r......... r..r........r......r.rr..Xw\",\n        \"w. ..r........r.....r.  ....d...r.rr...w\",\n        \"w....rd..r........r......r.rd......r...w\",\n        \"w... ..r. ..r.rr.........r.rd...... ..rw\",\n        \"w.d.... ..... ......... .r..r....r...r.w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 11,\n      tint: { wall: 280, rock: 280, diam: 45, dust: 280, expl: 0, mons: 0, void: 285 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"w.r..r..w.r...d.w... .r.wr......w..rr..w\",\n        \"w.......w......rwrr. ...w ..d...w....r.w\",\n        \"w                                      w\",\n        \"wd......w.r....rw.r. .. w..r..d.w..r.r.w\",\n        \"w.......w.r....rw.r. r..w.....r.w... ..w\",\n        \"wwwwwwwwwwwwwwwwwwww wwwwwwwwwwwwwwwwwww\",\n        \"w....rr.w..r....w... ..rw....r..w.....rw\",\n        \"w.......w.. ....w... ...w....r. w.....rw\",\n        \"w                                      w\",\n        \"wr..r...w....r..w..r ...w......dwr.....w\",\n        \"wr....r.w..r..r.w... . rw.......wr...r.w\",\n        \"w.r.....w...r...w... . rw.......w r..r.w\",\n        \"wwwwwwwwwwwwwwwwwwww wwwwwwwwwwwwwwwwwww\",\n        \"wr.  @..w....r.rw... ...w.rd..r.w......w\",\n        \"w.....r.wr......w..d ...w ..r...w.r.rr.w\",\n        \"w                                      w\",\n        \"wd.. .r.wr....r.w.r. ..rw.r.r...w......w\",\n        \"w.....r.wr..d...w... r..w..r....w...rr w\",\n        \"w.d... rw..r....w.Ed r..w. .....w...rr w\",\n        \"w.r.... w.. ..r.w.X.r...w....r.rw.... .w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 23,\n      tint: { wall: 120, rock: 80, diam: 180, dust: 330, expl: 0, mons: 0, void: 210 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wr.ww.wrr.w...rwr..r....w...r.....rw.d.w\",\n        \"w..Ew.d.r.w...www..w.r....r..r.r...w.wrw\",\n        \"w....w..rd..r....w.....r.wwr.......w.www\",\n        \"wd.w..wrwr..r....w...r......r.rr......ww\",\n        \"wr.w...w..r.ww..r.wwd.......r.rr......ww\",\n        \"wrr..r....w...r......r.rr......r..dww..w\",\n        \"w..r.ww..r.rr...w....r.rr......w..r.w.rw\",\n        \"w..w...d......d.r..wwr..r.w.wr..wr..d.rw\",\n        \"wr.r....w.ww..d.r..wwr..r..d.w...w..r.ww\",\n        \"w.r.ww.....rrwr..d.w.wr..wr...wr..d.r..w\",\n        \"ww.ww......rrwr..r.w.ww...w..r.ww..r.www\",\n        \"w.w.r.r.w...wwr..r....w...r.....ww.r.www\",\n        \"w.w.r.r.w.d.w.wr..wr....r..r.rr....w...w\",\n        \"ww..wrwr..r....w...d...w.rw......w.ww.dw\",\n        \"ww...wwr..w.d...wr..r.r...r.wr......w..w\",\n        \"ww.d....r.ww..r.wwr.......r.wr......w..w\",\n        \"w..r....w...r......r.rr......w..r.w...ww\",\n        \"wr.ww..r.ww...w....r.rr......w..rd..r..X\",\n        \"ww...r......r.rd......r...ww..wr..d.w..w\",\n        \"wrr...w.....r.rd......w..r.wd.d.rw.r...w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 20,\n      tint: { wall: 200, rock: 280, diam: 200, dust: 240, expl: 0, mons: 60, void: 200 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wE.....r....................r........r.w\",\n        \"w.....r..............r.................w\",\n        \"w........r..r..........................w\",\n        \"wr.....................................w\",\n        \"w...................r..................w\",\n        \"w.r.....................r.........r....w\",\n        \"w..r.....r...........r..r.............rw\",\n        \"w......r......r.....................r..w\",\n        \"w........ @...r.. @...... @...... @....w\",\n        \"w........  ...r..  ......  ......  .r..w\",\n        \"w......................................w\",\n        \"w...r..............................r...w\",\n        \"w...r.....r............................w\",\n        \"w......r...........r..................rw\",\n        \"w...........r.......r..................w\",\n        \"w..r..............r....................w\",\n        \"w.....................r.........r......w\",\n        \"w................................r..r..w\",\n        \"w....r......r.rr..................r....w\",\n        \"w...........r.rr.........r..r.r.......Xw\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 1,\n      tint: { wall: 100, rock: 20, diam: 100, dust: 0, expl: 0, mons: 240, void: 100 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwww\",\n        \"w                  w\",\n        \"w         r        w\",\n        \"w E       .        w\",\n        \"w                 @w\",\n        \"w                  w\",\n        \"w                  w\",\n        \"w                  w\",\n        \"w                  w\",\n        \"w                  w\",\n        \"w                 Xw\",\n        \"wwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 70,\n      tint: { wall: 30, rock: 90, diam: 120, dust: 300, expl: 0, mons: 140, void: 300 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wE.....................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w.......  @.....  @.....  @.....  @....w\",\n        \"w.......   .....   .....   .....   ....w\",\n        \"w....... d ..... d ..... d ..... d ....w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w.......  @.....  @.....  @.....  @....w\",\n        \"w.......   .....   .....   .....   ....w\",\n        \"w....... d ..... d ..... d ..... d ....w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w......................................X\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 40,\n      tint: { wall: 300, rock: 210, diam: 300, dust: 200, expl: 0, mons: 140, void: 300 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wwwwwwwwww....r.r..r........r.wwwwwwwwww\",\n        \"ww        ...........r....r...        ww\",\n        \"ww@d      ..r..........r...r..      d@ww\",\n        \"wwwwwwwwww..r........r......r.wwwwwwwwww\",\n        \"ww        ......r...r.......r.        ww\",\n        \"ww@d      ....r......r.rr.....      d@ww\",\n        \"wwwwwwwwww.rr........r.rr.....wwwwwwwwww\",\n        \"ww        ....r.r....r..r.....        ww\",\n        \"ww@d      ....r.r....r..r..r..      d@ww\",\n        \"wwwwwwwwww.rr.r..r....r...r...wwwwwwwwww\",\n        \"ww        .rr.r..r............        ww\",\n        \"ww@d      ....r..r........r...      d@ww\",\n        \"wwwwwwwwww.....r...r....r..r..wwwwwwwwww\",\n        \"w....r.r..r........r.....r............rw\",\n        \"w......r....r....r..r.r...r..r.........w\",\n        \"w..r....r.....r...r.......r..r.........w\",\n        \"w..r........r......r.rr.........r......w\",\n        \"wr.E...r...........r.rr.........rr..r.Xw\",\n        \"w....r......r.rr......r........r..r....w\",\n        \"wrr.........r.rr.........r..r.r.r..r...w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 13,\n      tint: { wall: 30, rock: 10, diam: 80, dust: 100, expl: 0, mons: 300, void: 100 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"w. .. .rr..... ..r. E.... rr r..r. .  .w\",\n        \"w ..r. .. .  .... .r.r. ...  r..r.d.. .w\",\n        \"wr.....  .@.  ... .r.r. ... wwwwwwwwwwww\",\n        \"w.r.d... .  ...... ..rr..r.... . ... . w\",\n        \"wwwwwwwwwwwww.r. ..   r.. .... ...r....X\",\n        \"wr. r...... ..r. ... ..r.  ..r.  @.....w\",\n        \"wr. r...... .. r..r.... ...r......r.rr.w\",\n        \"w... ..r  ... ..r.  ..r.  ... ....r.rr.w\",\n        \"w... ..r. .r.... ...@......r.r..  r..r.w\",\n        \"w  .. r.... ..r.r.... .  .......  d.. .w\",\n        \"w. ... .. .  .. .  .....rr r..r. . r.. w\",\n        \"w.. d..r.r.... .  ......r  r..r. .  ...w\",\n        \"w.r.  ..r.  ... .r.r. ...  r.. .... ...w\",\n        \"w....  .r.  ... .r.r. .r. . r.. r.... .w\",\n        \"w.  .... ....  .. r r..r.... ...r... .rw\",\n        \"w..... .  .rr. ...  r.. .r... r..r.r...w\",\n        \"w r...... ..r. .r.... .  ..r.  r.......w\",\n        \"w r...... .. r..r.... ...r......r.rr...w\",\n        \"w. ..r. ... ..r.  .aa.  ... ....r.rr...w\",\n        \"w. .dr@..r.... ...r......r.r@.....dr...w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 42,\n      tint: { wall: 30, rock: 10, diam: 20, dust: 130, expl: 0, mons: 130, void: 160 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"w . r.. . .. ..r. ..E ..r.  ..r. r... .w\",\n        \"w.r.rr...... ..r...r.... ...r.....dr.r.w\",\n        \"X r..r...  ...r..r. ..r.r...wwwwwwwwwwww\",\n        \"w...d ..r. @.....r..... ........rr r..rw\",\n        \"wwwwwwwwwwwww..r.r.... .  ......r  r..rw\",\n        \"w.  ... ..r.  ..r.  .... rrr.....  r.. w\",\n        \"w... r... @.. ..r.  .....r.rr..r. . r..w\",\n        \"w..r. ..r. r.... ..... ...r r..r.... ..w\",\n        \"w.....r ...... .  @rr. ...  r.. .r....rw\",\n        \"wr.r... . r...... ..r...r....r....dr.  w\",\n        \"w......r. r......... r..r...wwwwwwwwwwww\",\n        \"w.rr...... ..r. ...d..r.  ..r.  ... r..w\",\n        \"wwwwwwwwwwwwwr........ ...r......r.rr..w\",\n        \"w..r...  ...d..r. ..r.rr.........r.rr..w\",\n        \"w.. ..r. .r...@@@@@@@@.........  r..r..w\",\n        \"wr.. r....r..r r...d .. .......  r..r..w\",\n        \"w ... ..r. ...r.  .....rrrr..r. . r.. rw\",\n        \"w. r..@.r.... .  ......rr r..r...  ...rw\",\n        \"wr.  ..r.  .....r.r. ...  r..r.... ...rw\",\n        \"w...  .r.r .....r.r.....   .. .r....r..w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 16,\n      tint: { wall: 180 , rock: 239 , diam: 45 , dust: 245 , expl: 320 , mons: 357 , void: 133 },\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwww\",\n        \"wr@...............rw\",\n        \"wEr@.............rXw\",\n        \"wd.r@...........r.dw\",\n        \"wrd.r@.........r.drw\",\n        \"w.rd.r@.......r.dr.w\",\n        \"w..rd.r@.....r.dr..w\",\n        \"w...rd.r@...r.dr...w\",\n        \"w....rd.r@.r.dr....w\",\n        \"w.....rd.rr.dr.....w\",\n        \"w......rd..dr......w\",\n        \"wwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 50,\n      tint: {wall: 26 , rock: 71 , diam: 264 , dust: 247 , expl: 56 , mons: 275 , void: 120},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wdddrrddrddr.rrrrdrdd.ddrddrddddrrdrdrrw\",\n        \"wdrrdddrdddrdddrrrrrdrrd.drdrrrrdrddrrdw\",\n        \"wddrrrrrdddrddrd.rrrdrrdddrdr.rrdrrrddrw\",\n        \"wrrdrddrrdrrrddrddd..ddrrdrddrrdrdd.rrdw\",\n        \"wrrdrddrrrrrrddrd.drdrrrrdrdrdrrddrrdrdw\",\n        \"wdddrrdrd.ddrrddrrdddrrdrdrrr.drddrrdrdw\",\n        \"wrrrrrdrrdddd..rrrdrdd.rdrddr.rrddddddrw\",\n        \"wdrddwwwwwww.wwwwwdrrrrdrwwwwww.wwwwwwrw\",\n        \"wd.ddw           wrddrrrdw           wrw\",\n        \"wdrdrw EX        wrddrrrdw           wrw\",\n        \"wdrrdw           wr.rrddrw           wrw\",\n        \"wdrrdw           wddddrdrw           wdw\",\n        \"wrdddw           wdrrd.drw           wdw\",\n        \"wrrrrw           wdrrddrrw           wrw\",\n        \"wdrddw           w.rdrrdrw           wrw\",\n        \"wdrddw           wwwwwwwww           wrw\",\n        \"wrrrdw                               wrw\",\n        \"wrrrdw           wdd.rdrdw           wrw\",\n        \"wddrrw           wrrrdrddw           wrw\",\n        \"wdd..wwwwwwwwwwwwwdrrrdddwwwwwwwwwwwwwdw\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 16,\n      tint: {wall: 33 , rock: 216 , diam: 73 , dust: 82 , expl: 92 , mons: 189 , void: 276},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"w............E.........................w\",\n        \"wwwwwwwwwwwww wwwwwwww.................w\",\n        \"ww....d.............dw.................w\",\n        \"ww.w w.wwwwww wwwwww.w.................w\",\n        \"ww.w@w.wd.........dw.w.................w\",\n        \"ww.w@w.w.wwww wwww.w.w.................w\",\n        \"ww.w@w.w.wd.....dw.w.w.................w\",\n        \"ww.w@w.w.w.ww ww.w.w.w.................w\",\n        \"ww.w@w w w w   w w w w.................w\",\n        \"ww.w@w@w@w@w@@@w@w@w@w.................w\",\n        \"ww.w@w w w w   w w w w.................w\",\n        \"ww.w@w.w.w.wwwww.w.w.w.................w\",\n        \"ww.w@w.w.wd.....dw.w.w.................w\",\n        \"ww.wdw.w.wwwwwwwww.w.w.................w\",\n        \"ww.wdw.wd.........dw.w.................w\",\n        \"ww.wdw.wwwwwwwwwwwww.w.................w\",\n        \"ww.wdwd.............dw.................w\",\n        \"wwwwwwwwwwwwwwwwwwwwww.................w\",\n        \"w......................................w\",\n        \"wX.....................................w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 6,\n      tint: {wall: 161 , rock: 339 , diam: 235 , dust: 70 , expl: 140 , mons: 135 , void: 303},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wr.rd.rrr.w...drr..rw...d...r.w...dr.r.w\",\n        \"w... .r.r.w...r r..rwr....r..rwr...r.rrw\",\n        \"w.... ..rrw.r....r..w..r. rr..w....r.rrw\",\n        \"wr.r.. rrrw.r.... ..wr......r.wr......rw\",\n        \"wr. ...r..w.  ..r.rrw.......r.wr...... w\",\n        \"wrr..r....w...r.....wr.rr.....wr..r r..w\",\n        \"w..r.rr..rwrr...r...wr.rr.....wr..r. .ww\",\n        \"w..r...r..w...r.r..rwr..r. .rrw. r..@wrw\",\n        \"wr.r.wwwwwwwww@wwwwwwwwwrwwwwwwwww..w. w\",\n        \"w.r.  .....rrrr..r.r.rr..rr... r..rwr..w\",\n        \"wr.rr......rrrr..r. . r...r..r.rr.wr.rrw\",\n        \"w. .r.r. w..rrr..r.... ...r.....rw.r.rrw\",\n        \"w. .r.r. wr.wwwwwwwwwwwwwwwwwrr.w..r...w\",\n        \"wr.. rrr.wr....r...r... .rr....w.r.rr.rw\",\n        \"wr...rrr.wr.r... r..r.r...r.rrw.....r.Xw\",\n        \"w .r....rw  ..r.rrr.......r.rw...... ..w\",\n        \"w..r.... w..r......r.rr.....wr..r.r...rw\",\n        \"wr.rr..r.wr...r....rErr......r..r@..r..w\",\n        \"wr...r...w..r.r@......r... r.. r..rdr..w\",\n        \"wrr.d. ..w..r.rr......r..r. r.@.rr.r...w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 22,\n      tint: {wall: 99 , rock: 91 , diam: 112 , dust: 72 , expl: 71 , mons: 192 , void: 220},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wr. ...rr.....r.r..r........r.....r..d.w\",\n        \"w.....d.r....... ....r....r..r..... ..rw\",\n        \"w.......rdw.r.w.. w...wr...r... @.. .. w\",\n        \"wdwwwwwwwwwww.w...w..rw.....r..  ......w\",\n        \"wr........w...w.r.w d.w.....r..........w\",\n        \"wrr..r....w...w...w..rwrr......r..d....w\",\n        \"w..r.....rwrr.w...w..rwrr.........r...rw\",\n        \"w.wwwwwwwwwww.w.r.w .rw.r....r. @...d.rw\",\n        \"wr.r......w...w.r.w..rw.r..d...  ...r..w\",\n        \"w.r.......wrr w..dw.. w...r.......d.r..w\",\n        \"w ........wrr w..rw...w... ..r.....r...w\",\n        \"w.wwwwwwwwwwwwwwwrw...w...r........r.  w\",\n        \"w...r.r...w...wr..wr..w.r..r.r. @......w\",\n        \"w....r r..w...w...wd..w..r ....  .....dw\",\n        \"w.... .r..w.d.w..rw.r.w...r. r.........w\",\n        \"w.wwwwwwwwwww.w...w...w...r. r.........w\",\n        \"w..r......w.r.w...wr.rw...... ..r......w\",\n        \"wr.E...r. w...w...wr.rw.........rd..r..w\",\n        \"w....r....w.r.wd..w...w.... ...r..d. ..X\",\n        \"wrr.......w.r.wd..w...w..r..d.d.r..r...w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 14,\n      tint: {wall: 166 , rock: 95 , diam: 98 , dust: 46 , expl: 293 , mons: 329 , void: 21},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwww\",\n        \"w       E          w\",\n        \"w                  w\",\n        \"w                  w\",\n        \"w                  w\",\n        \"w                 Xw\",\n        \"w                  w\",\n        \"w              @@@@w\",\n        \"w              @@@@w\",\n        \"w              @@@@w\",\n        \"wdddddddddddddd@@@@w\",\n        \"wwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 10,\n      tint: {wall: 105 , rock: 55 , diam: 192 , dust: 74 , expl: 53 , mons: 142 , void: 169},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wr.....rr.X.....r.Era.......r........r.w\",\n        \"w.....r.r............r....r..r.r.......w\",\n        \"w........r..r..............r...........w\",\n        \"wr.......r...........r......r..r.......w\",\n        \"wr........r.....r...r.......r..r.......w\",\n        \"w.r..r........r......r.rr.........r....w\",\n        \"w..r.....r...........r.rr.........r...rw\",\n        \"w......r......r.r....r..r........r..r..w\",\n        \"wr.r..........r.r..........r...........w\",\n        \"w..........rr.r..r....r...r....r..r.r..w\",\n        \"w..........r..r..r...........r.....r...w\",\n        \"w...r.r.......r...........r........r...w\",\n        \"w...r.r...r....r...r.......r...........w\",\n        \"w....r.r..r........r.....r............rw\",\n        \"w......r....r....r..r.r......r.........w\",\n        \"w..r.wwwwwwwwwwwwwwwwwwwwwwwwwwwwww....w\",\n        \"w..r.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@....w\",\n        \"wr...rrrrrrrrrrrrrrrrrrrrrrrrrrrrrr.r..w\",\n        \"w......................................w\",\n        \"w.r................................r...w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 50,\n      tint: {wall: 165 , rock: 0 , diam: 252 , dust: 134 , expl: 113 , mons: 72 , void: 229},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"w..E...................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w.....................@.@.@.@.@.@......w\",\n        \"w.....................r.r.r.r.r.r......w\",\n        \"w......................................w\",\n        \"w......................................w\",\n        \"w.........@. . . . . ..................w\",\n        \"w......... . . . . . ..................w\",\n        \"w......... .@. . . . ..................w\",\n        \"w......... . . . . . ..................w\",\n        \"w......... . .@. . . ..................w\",\n        \"w......... . . . . . ..................w\",\n        \"w......... . . .@. . ..................w\",\n        \"w......... . . . . . ..................w\",\n        \"w......... . . . .@. ..................X\",\n        \"w......... . . . . . ..................w\",\n        \"w......... . . . . .@..................w\",\n        \"w......................................w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 32,\n      tint: {wall: 0, rock: 320, diam: 35, dust: 300, expl: 113, mons: 202, void: 0},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wr.rr..  r..r..r.r..Er..r.rr..r.rr...r.w\",\n        \"w.w.rr......r..r...r....w...r......r.r.w\",\n        \"wrrw.r... r.. r..r.r..rwr.... .. ..r.r@w\",\n        \"w...wr..r. @.....r. ..wr.  .....rrrr..rw\",\n        \"w.rr.wrr... r..r.r...wr. r......rrrr..rw\",\n        \"w. r..wr..r.r ..r.rrw... rrr. ...rrr..rw\",\n        \"w...rr.w.@ ..r..r.rw.....r.rr..r.r.rr..w\",\n        \"w..r.r..w.rr.... .w...r.. rrr..r....r..w\",\n        \"w... .rr.w....r. w@rr. ...rrr..r.r... rw\",\n        \"wr.r...r.rw.....wr..r. .r....r.  ..r.rrw\",\n        \"w......r.rrw...w. ..rr..r.... ...r.....w\",\n        \"w.rr......r....r...r..r.r ..r.rr... r..w\",\n        \"w.rr......r.@@@..r....r...r......r.rr..w\",\n        \"w..r... r...r..r.r..r.rr... .....r.rr..w\",\n        \"w..r..r. .r....r.....r.  ......rrr..r. w\",\n        \"wr.. r....r..r.r....r.  .......rrr..r..w\",\n        \"wr...r..r.  ..r.  .... rrrr..r.r.rr..rrw\",\n        \"w. r..@ r....r.rr......rrrr..r. .rr.. rw\",\n        \"wr.rr..r.rr... .r.r. ...rrr..r.... ...rw\",\n        \"w...rr.r.rr... .r.r.X...r r..r.r....r..w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 30,\n      tint: {wall: 100, rock: 120, diam: 235, dust: 20, expl: 313, mons: 102, void: 200},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\",\n        \"wE..r..........r........r.....r..r.....w\",\n        \"w.r.rr.........r...r........r......r.r.X\",\n        \"w.r..r........r..r....r.r..........r.rrw\",\n        \"w.......r..r.....r..............rr.r..rw\",\n        \"w..r...r....r..r.r..............r..r..rw\",\n        \"w.........r.....r........rrr.......r...w\",\n        \"w....r....r.....r........r.rr..r....r..w\",\n        \"w..r...@@@@@@..@@@@@@.....r.r..r.......w\",\n        \"w.....rw....w..w..rrw.......r....r....rw\",\n        \"wr.r...w..r.w..w....w...r....r.....r...w\",\n        \"w......w..r.w..w....wr..r........r.....w\",\n        \"w.rr...w....wr.w....w.r.....r.......r..w\",\n        \"w.rr...w....wrrw.r..w.....r......r.rr..w\",\n        \"w..r...w....w..w....w.rr.........r.rr..w\",\n        \"w.....rwwwwww..wwwwww............r..r..w\",\n        \"wr...r....r..r.r.................r..r..w\",\n        \"w.............r........r.....r........rw\",\n        \"w..r..r. @...... @.....r. @..r... @...rw\",\n        \"wr.....r  ......  .......  ..r...  ...rw\",\n        \"w......r.......................r....r..w\",\n        \"wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    {\n      need: 18,\n      tint: {wall: 320, rock: 70, diam: 70, dust: 70, expl: 70, mons: 70, void: 70},\n      rows: [\n        \"wwwwwwwwwwwwwwwwwwwww\",\n        \"w..E.......rrr......w\",\n        \"w..........rrr......w\",\n        \"w...................w\",\n        \"w..........@@@......w\",\n        \"w.......r..   ......w\",\n        \"w........r.   ......w\",\n        \"w.........r   ......w\",\n        \"w........X.@@@......w\",\n        \"w..........   ......w\",\n        \"w..........   ......w\",\n        \"wwwwwwwwwwwwwwwwwwwww\"\n      ]\n    },\n    //############################################################\n    {\n      // Nombre de diamants nécessaire pour ouvrir la sortie.\n      need: 2,\n      // Variation de la teinte pour chaque élément.\n      tint: { wall: 120, rock: 80, diam: 180, dust: 330, expl: 0, mons: 0, void: 210 },\n      rows: [\n        \"wwwwwww\",\n        \"wEddXw\",\n        \"wwwwwww\"\n      ]\n    }\n\n  ];\n\nexport default Levels;\n","import { TScores } from \"../types\"\n\n/**\n * Les  high-scores  sont  stoqués  sous forme  d'un  tableau  de  8\n * éléments.  Chaque  élément  est  lui-même un  tableau  avec  deux\n * éléments : le nom du joueur et son score.\n */\nconst DEFAULT_HIGH_SCORES: TScores = [\n    ['Daisy', 17132],\n    ['John', 16000],\n    ['Samantha', 11728],\n    ['Henry', 8226],\n    ['Virginia', 4100],\n    ['William', 1950],\n    ['Natalia', 900],\n    ['Paul', 650]\n];\n\n/**\n * Lire les scores depuis le local storage.\n */\nfunction loadFromLocalStorage(): TScores {\n    var scores = window.localStorage.getItem(\"boulder-dash/scores\");\n    if (!scores) {\n        return DEFAULT_HIGH_SCORES;\n    } else {\n        try {\n            scores = JSON.parse(scores);\n            if (!Array.isArray(scores)) return DEFAULT_HIGH_SCORES;\n        } catch (ex) {\n            console.error(ex);\n            return DEFAULT_HIGH_SCORES;\n        }\n    }\n    return scores;\n};\n\n/**\n * Sauvegarder les scores dans le local storage.\n */\nfunction saveToLocalStorage(scores: TScores) {\n    window.localStorage.setItem(\"boulder-dash/scores\", JSON.stringify(scores));\n}\n\n/**\n * Classe de gestion des high-scores.\n */\nexport default class HighScore {\n    _scores: TScores = loadFromLocalStorage();\n    _lastNewHighScore: number = -1;\n\n    /**\n     * Retourner une copie des scores.\n     */\n    getScores(): TScores {\n        return this._scores.slice();\n    }\n\n    /**\n     *\n     */\n    getLastHighScoreIndex(): number {\n        return this._lastNewHighScore;\n    }\n\n    /**\n     * Vérifier si le score donné peut figurer parmi les 8 meilleurs.\n     */\n    isAnHighScore(score: number): boolean {\n        return score > this._scores[this._scores.length - 1][1];\n    }\n\n    /**\n     * @param {string} name - Nom du joueur.\n     * @param {number} score - Son score.\n     */\n    addScore(name: string, score: number) {\n        const scores = this._scores;\n        for (let k = 0; k < scores.length; k++) {\n            if (score > scores[k][1]) {\n                // Mémorisons l'emplacement du dernier score inséré\n                // ça permettra de le mettre en évidence.\n                this._lastNewHighScore = k;\n                // On insère le score à sa place.\n                scores.splice(k, 0, [name, score]);\n                // On s'assure qu'il n'y en a pas plus que 8.\n                while (scores.length > 8) scores.pop();\n                saveToLocalStorage(scores);\n                return true;\n            }\n        }\n        return false;\n    }\n}\n","import WebGL from \"./webgl\"\n\n\nexport default class Transition {\n    constructor(gl, assets) {\n        var data = this.createData();\n        this._buffVert = WebGL.fillArrayBuffer(gl, data);\n        this._prg = new WebGL.Program(gl, {\n            vert: assets.transitionVert,\n            frag: assets.transitionFrag\n        });\n        this._gl = gl;\n        this._mode = 0;\n    }\n\n    /**\n     * On va créer des rectangles noirs qui vont  s'épaissir jusqu'à remplir l'écran.\n     * Le Z sera fixé à 1 et on affichera les rectangles avant tout le reste.\n     */\n    private createData() {\n        var data = [];\n        // Nombre de rectangles par demi-espace.\n        // Si n vaut 1, on aura deux rectangles symétriques par rapport à l'axe vertical qui vont chacun\n        // remplir leur demi-espace respectif.\n        var n = 4;\n        // Comme on veut fair eune rotation, il faut que  la largeur soit au moins égale à la diagoinale\n        // d'un carré de largeur 1. D'où le racine de 2.\n        var radius = Math.sqrt(3);\n\n        var k, centerX;\n        var size = radius / (2 * n);\n        for (k = 0; k < n; k++) {\n            centerX = radius * (0.5 + k) / n;\n            data.push(\n                centerX, -size, -10,\n                centerX, -size, +10,\n                centerX, +size, +10,\n                centerX, +size, +10,\n                centerX, +size, -10,\n                centerX, -size, -10\n            );\n            data.push(\n                -centerX, -size, -10,\n                -centerX, -size, +10,\n                -centerX, +size, +10,\n                -centerX, +size, +10,\n                -centerX, +size, -10,\n                -centerX, -size, -10\n            );\n        }\n        this._count = 12 * n;\n        return new Float32Array(data);\n    }\n\n    draw(time, width, height) {\n        var dir = 1;\n\n        switch (this._mode) {\n            case 0:\n                return;\n            case 1:\n                this._time = time;\n                this._mode = 2;\n                return;\n            case 2:\n                time = (time - this._time) / this._duration;\n                if (time > 1) {\n                    time = 1;\n                    this._mode = 3;\n                }\n                break;\n            case 3:\n                if (typeof this._action === 'function') {\n                    this._action();\n                }\n                this._time = time;\n                this._mode = 4;\n                time = 1;\n                break;\n            case 4:\n                time = 1 - (time - this._time) / this._duration;\n                if (time < 0) {\n                    this._mode = 0;\n                    time = 0;\n                } else {\n                    dir = -1;\n                }\n                break;\n        }\n\n        var gl = this._gl;\n        var prg = this._prg;\n\n        prg.use();\n        prg.$uniDir = dir;\n        prg.$uniTime = time;\n        prg.$uniWidth = width;\n        prg.$uniHeight = height;\n\n        prg.bindAttribs(this._buffVert, \"attCenterX\", \"attX\", \"attY\");\n        gl.drawArrays(gl.TRIANGLES, 0, this._count);\n    }\n\n    /**\n     * L'écran devient noir, une action est déclenchée et l'écran s'éclaircit à nouveau.\n     *\n     * @param {function} action - Fonction à appeler quand l'écran est entièrement noir.\n     * @param {number} duration - Nombre de millisecondes que dure la transition.\n     */\n    start(action, duration) {\n        this._action = action;\n        this._duration = duration;\n        this._mode = 1;\n    }\n}\n","const STILL = 0;\nconst UP = 1;\nconst RIGHT = 2;\nconst DOWN = 3;\nconst LEFT = 4;\nconst SUICIDE = 5;\nconst START = 6;\nconst state = [0, 0, 0, 0, 0, 0, 0];\n\nfunction clear() {\n    state[0] = state[1] = state[2] = state[3] = state[4] = state[5] = 0;\n}\n\n// Mouvement à l'aide des touches du clavier.\ndocument.addEventListener(\"keydown\", function(evt) {\n    var catchKey = true;\n    switch (evt.key.toLowerCase()) {\n        case 'arrowup':\n            state[UP] = 1;\n            break;\n        case 'arrowright':\n            state[RIGHT] = 1;\n            break;\n        case 'arrowdown':\n            state[DOWN] = 1;\n            break;\n        case 'arrowleft':\n            state[LEFT] = 1;\n            break;\n        case 'escape':\n            state[SUICIDE] = 1;\n            break;\n        case 'space':\n            state[START] = 1;\n            break;\n        default:\n            catchKey = false;\n    }\n    if (catchKey) evt.preventDefault();\n}, true);\ndocument.addEventListener(\"keyup\", function(evt) {\n    switch (evt.key.toLowerCase()) {\n        case 'arrowup':\n            state[UP] = 0;\n            break;\n        case 'arrowright':\n            state[RIGHT] = 0;\n            break;\n        case 'arrowdown':\n            state[DOWN] = 0;\n            break;\n        case 'arrowleft':\n            state[LEFT] = 0;\n            break;\n        case 'escape':\n            state[SUICIDE] = 0;\n            break;\n        case 'space':\n            state[START] = 0;\n            break;\n    }\n}, true);\n\n//=========\n// GAMEPAD\n//---------\nlet gamepad = null;\n\nwindow.addEventListener(\"gamepadconnected\", function(e) {\n    console.log(\"Gamepad connected at index %d: %s. %d buttons, %d axes.\",\n        e.gamepad.index, e.gamepad.id,\n        e.gamepad.buttons.length, e.gamepad.axes.length);\n    gamepad = e.gamepad;\n});\n\nwindow.addEventListener(\"gamepaddisconnected\", function(e) {\n    if (e.gamepad === gamepad) gamepad = null;\n});\n\n\n// Mouvement au toucher.\n// Quand on arrête de toucher l'écran, le héro s'arrête.\n// Sinon, il continue dans la direction courante.\n// Pour définir une direction, il faut glisser son doigt\n// dans la direction voulue en gardant le doigt sur l'écran.\nvar touchX, touchY, touchId = null;\nvar dir = '';\ndocument.addEventListener(\"touchstart\", function(evt) {\n    // S'il y a déjà un doigt sur l'écran, on ignore les suivants.\n    if (touchId) return;\n\n    var touch = evt.changedTouches[0];\n    touchId = touch.identifier;\n    touchX = touch.clientX;\n    touchY = touch.clientY;\n    clear();\n    if (touchX < screen.width / 2) dir = 'H';\n    else dir = 'V';\n});\ndocument.addEventListener(\"touchmove\", function(evt) {\n    var touch = evt.changedTouches[0];\n    // S'agit-il bien du premier doigt ?\n    if (touch.identifier !== touchId) return;\n\n    var vx = touch.clientX - touchX;\n    var vy = touch.clientY - touchY;\n    touchX += vx;\n    touchY += vy;\n\n    if (Math.abs(vx) < Math.abs(vy)) {\n        // Déplacement vertical.\n        state[LEFT] = state[RIGHT] = 0;\n        if (vy > 1) {\n            state[DOWN] = 1;\n            state[UP] = 0;\n        }\n        else if (vy < -1) {\n            state[DOWN] = 0;\n            state[UP] = 1;\n        }\n    } else {\n        // Déplacement horizontal.\n        state[UP] = state[DOWN] = 0;\n        if (vx > 1) {\n            state[RIGHT] = 1;\n            state[LEFT] = 0;\n        }\n        else if (vx < -1) {\n            state[RIGHT] = 0;\n            state[LEFT] = 1;\n        }\n    }\n});\n\nvar context = {\n    STILL: 0,\n    UP: UP,\n    RIGHT: RIGHT,\n    DOWN: DOWN,\n    LEFT: LEFT,\n    SUICIDE: SUICIDE,\n    START: START\n};\n\nObject.defineProperty(context, \"action\", {\n    get: function() {\n        if (gamepad) {\n            const axes = gamepad.axes;\n            let index = 0;\n            let value = Math.abs(axes[0]);\n            for (let k = 1; k < axes.length; k++) {\n                const v = Math.abs(axes[k]);\n                if (v > value) {\n                    index = k;\n                    value = v;\n                }\n            }\n            if (value > .4) {\n                value = axes[index];\n                if (value > 0) {\n                    // Right or down.\n                    if (index % 2 === 0) return RIGHT;\n                    return DOWN;\n                } else {\n                    // Left or up.\n                    if (index % 2 === 0) return LEFT;\n                    return UP;\n                }\n            }\n            var pressedButtonIndex = -1;\n            gamepad.buttons.forEach(function(button, idx) {\n                if (button.pressed) pressedButtonIndex = idx;\n            });\n            if (pressedButtonIndex > -1) {\n                if (pressedButtonIndex < 4) return SUICIDE;\n                return START;\n            }\n        }\n        if (state[UP]) return UP;\n        if (state[RIGHT]) return RIGHT;\n        if (state[DOWN]) return DOWN;\n        if (state[LEFT]) return LEFT;\n        if (state[SUICIDE]) return SUICIDE;\n        return STILL;\n    }\n});\n\nexport default context;\n","import \"./message.css\"\n\nexport default {\n    show(msg: string, isGoodNews: boolean=false) {\n        const div = document.createElement(\"div\");\n        div.className = \"message\";\n        const text = document.createElement(\"div\");\n        if( isGoodNews ) {\n            text.style.color = \"#0f3\";\n        }\n        text.textContent = msg;\n        div.appendChild(text);\n\n        document.body.appendChild(div);\n        setTimeout(()=> {\n            div.classList.add(\"show\");\n            setTimeout(() => {\n                div.classList.add(\"hide\");\n                setTimeout(()=> {\n                    document.body.removeChild(div);\n                }, 300);\n            }, 1300);\n        });\n    }\n}\n","import Level from \"./level\"\nimport Message from \"./message\"\nimport GameInputs from \"./game-inputs\"\nimport { IEnvironment } from \"../types\"\n\nexport default { createEnv, apply, process };\n\nfunction isRockOrDiam(level, col, row) {\n    var cell = level.getType(col, row);\n    return cell === Level.ROCK || cell === Level.DIAM;\n}\n\nfunction isRockOrDiamOrWall(level, col, row) {\n    var cell = level.getType(col, row);\n    return cell === Level.ROCK || cell === Level.DIAM || cell === Level.WALL;\n}\n\nfunction prepareMove(col, row, vx, vy, env) {\n    if (vx === 0 && vy === 0) return;\n    var level = env.level;\n    var src = level.getType(col, row);\n    var dst = level.getType(col + vx, row + vy);\n    if (dst === Level.HERO) env.killHero();\n    else {\n        level.setMove(col, row, vx, vy);\n        level.setType(col + vx, row + vy, -src);\n    }\n};\n\nfunction processFallingRockOrDiam(level, col, row, env, below) {\n    // La pierre est déjà en train de tomber.\n    // On regarde s'il y a autre chose que du vide dessous. Si c'est\n    // le cas, la chute est stoppée,  mais il peut aussi y avoir des\n    // conséquences sur l'élément qui se trouvait en dessous.\n    if (below !== Level.VOID) {\n        // On arrête la chute dans tous les cas.\n        level.setVY(col, row, 0);\n        if (below == Level.ROCK || below == Level.WALL || below == Level.DUST) {\n            // Le rocher  (ou diamant)  a été  stoppé :  on joue  un son\n            // adéquat.\n            env.playBoom();\n        }\n        else if (below == Level.HERO) {\n            // On tombe sur le héro : ça le tue.\n            env.killHero();\n        }\n        else if (below == Level.MONS) {\n            // On écrase un monstre.\n            level.setType(col, row, Level.VOID);\n            env.explode(col, row + 1, true);\n        }\n        else if (below == Level.DIAM) {\n            // Si c'est une pierre qui tombe sur un diamant, il explose.\n            if (level.getType(col, row) === Level.ROCK) {\n                level.setType(col, row, Level.VOID);\n                env.explode(col, row + 1);\n            }\n        }\n    } else {\n        level.setType(col, row + 1, Level.BOOM);\n    }\n}\n\nfunction processSteadyRockOrDiam(level, col, row, env, below) {\n    // La pierre est au repos.\n    if (below === Level.VOID) {\n        level.setMove(col, row, 0, 1);\n        level.setType(col, row + 1, Level.BOOM);\n    }\n    else if (isRockOrDiamOrWall(level, col, row + 1)) {\n        if (!isRockOrDiam(level, col, row - 1)) {\n            // Si un rocher est posé sur un autre  et qu'il n'est pas sous un rocher/diamant, alors il\n            // peut basculer à droite ou à gauche si l'espace est libre.\n            if (level.getType(col + 1, row) == Level.VOID\n                && level.getType(col + 1, row + 1) == Level.VOID\n                && !isRockOrDiam(level, col + 1, row - 1)) {\n                // On tombe sur la droite.\n                level.setMove(col, row, +1, 0);\n            }\n            else if (level.getType(col - 1, row) == Level.VOID\n                && level.getType(col - 1, row + 1) == Level.VOID\n                && !isRockOrDiam(level, col - 1, row - 1)) {\n                // On tombe sur la gauche seulement s'il n'y a pas déjà un\n                // rocher qui tombe sur la droite juste en face.\n                if (col < 2 || !isRockOrDiam(level, col - 2, row) || level.getVX(col - 2, row) < 1) {\n                    level.setMove(col, row, -1, 0);\n                }\n            }\n        }\n    }\n}\n\nfunction processRockOrDiam(level, col, row, env) {\n    level.setVX(col, row, 0); // On arrête tout déplacement horizontal.\n\n    var below = level.getType(col, row + 1);\n    var falling = level.getVY(col, row) != 0;\n    if (falling) {\n        processFallingRockOrDiam(level, col, row, env, below);\n    } else {\n        processSteadyRockOrDiam(level, col, row, env, below);\n    }\n}\n\nfunction processExplosion1(env, level, col, row) {\n    // Une explosion a une durée de vie de 2 cycles.\n    if (level.getIndex(col, row) > 0) {\n        // Encore un cycle...\n        level.setIndex(col, row, level.getIndex(col, row) - 1);\n    } else {\n        // C'est terminé pour l'explosion.\n        level.setType(col, row, Level.VOID);\n    }\n}\n\nfunction processExplosion2(env, level, col, row) {\n    // Une explosion a une durée de vie de 2 cycles.\n    if (level.getIndex(col, row) > 0) {\n        // Encore un cycle...\n        level.setIndex(col, row, level.getIndex(col, row) - 1);\n    } else {\n        // C'est terminé pour l'explosion.\n        level.setType(col, row, Level.DIAM);\n        level.setIndex(col, row, Math.floor(Math.random() * 16));\n    }\n}\n\n// Directions du monstre en fonction de attIndex.\n// Il essaie  d'aller dans sa  direction et si c'est  impossible, il\n// essaie sur sa droite et ainsi de suite...\nconst dirs = [[0, -1], [1, 0], [0, 1], [-1, 0]];\nfunction processMonster(env, level, col, row) {\n    var dir = level.getIndex(col, row);\n    var d, k;\n    var vx, vy, v;\n    var target;\n    for (k = 5; k > 1; k--) {\n        d = (dir + k) % 4;\n        v = dirs[d];\n        vx = v[0];\n        vy = v[1];\n        target = level.getType(col + vx, row + vy);\n        switch (target) {\n            case Level.VOID:\n                prepareMove(col, row, vx, vy, env);\n                level.setIndex(col, row, d);\n                return;\n            case Level.HERO:\n                env.killHero();\n                return;\n            case Level.ROCK:\n            case Level.DIAM:\n                if (d == 0) {\n                    // Si on  monte vers  une pierre,  c'est qu'elle  nous fonce\n                    // dessus.\n                    env.explode(col, row, true);\n                    return;\n                }\n                break;\n            case Level.BOOM:\n                env.explode(col, row, true);\n                return;\n        }\n    }\n    level.setMove(col, row, 0, 0);\n}\n\nfunction processHero(env, level, col, row, heroMoves, action) {\n    // Si le héro est mort, on ne fait rien du tout.\n    if (!env.isHeroAlive) {\n        env.camX = 0;\n        env.camY = 0;\n        return;\n    }\n\n    var move = true;\n\n    var vx = 0;\n    var vy = 0;\n\n    switch (action) {\n        case GameInputs.UP:\n            vx = 0;\n            vy = -1;\n            break;\n        case GameInputs.RIGHT:\n            vx = 1;\n            vy = 0;\n            level.setIndex(col, row, 0);\n            break;\n        case GameInputs.DOWN:\n            vx = 0;\n            vy = 1;\n            break;\n        case GameInputs.LEFT:\n            vx = -1;\n            vy = 0;\n            level.setIndex(col, row, 1);\n            break;\n        case GameInputs.SUICIDE:\n            env.killHero();\n            move = false;\n            break;\n        default:\n            move = false;\n            break;\n    }\n\n    if (move) {\n        var nextX = col + vx;\n        var nextY = row + vy;\n        var cell = level.getType(nextX, nextY);\n        if (cell === Level.WALL || cell === Level.HERO) {\n            // Les murs arrêtent le déplacement. Les clones aussi.\n            env.camX = col;\n            env.camY = row;\n            env.camVX = 0;\n            env.camVY = 0;\n            return;\n        }\n\n        if (cell === Level.ROCK) {\n            // Les rochers aussi, mais ils  peuvent être poussés s'ils ont\n            // un espace vide derrière eux.\n            if (vx === +1 && level.getType(nextX + 1, nextY) === Level.VOID) {\n                level.setVX(nextX, nextY, +1);\n                level.flag(nextX, nextY);\n            }\n            else if (vx === -1 && level.getType(nextX - 1, nextY) === Level.VOID) {\n                level.setVX(nextX, nextY, -1);\n            }\n            // Le héro s'arrête net parce que le rocher est lourd.\n            level.setMove(col, row, 0, 0);\n            vx = vy = 0;\n        }\n        else {\n            heroMoves.push([col, row]);\n            level.flag(nextX, nextY);\n            level.setMove(col, row, vx, vy);\n        }\n    }\n    env.camX = col;\n    env.camY = row;\n    env.camVX = vx;\n    env.camVY = vy;\n}\n\n\n\n// Déterminer les déplacements futurs.\nfunction process(env, action) {\n    // Chaque héro peut manger de la terres (feuilles), mais il faut\n    // la retirer dans  un deuxième temps pour éviter  des effets de\n    // bord sur la chute de pierres vers la gauche.\n    // En effet, si on a une pile de pierre à deux cases à droite du\n    // héro et  que ce dernier  creuse juste à droite,  la prochaine\n    // case analysée sera celle de la pierre et on verra qu'il n'y a\n    // plus rien  à gauche, alors  qu'en réalité, c'est le  héro qui\n    // est censé prendre cette place.\n    // Le résultat  sera que  la pierre  et le  héro auront  la même\n    // cellule comme destination.\n    // `heroMoves` contient les coordonnées du héro.\n    var heroMoves = [];\n\n    var level = env.level;\n    var row, col, cell;\n    for (row = 0; row < level.rows; row++) {\n        for (col = 0; col < level.cols; col++) {\n            if (level.hasFlag(col, row)) {\n                level.unflag(col, row);\n                continue;\n            }\n\n            cell = level.getType(col, row);\n            if (cell === Level.ROCK || cell === Level.DIAM) {\n                processRockOrDiam(level, col, row, env);\n            }\n            else if (level.getType(col, row) === Level.HERO) {\n                processHero(env, level, col, row, heroMoves, action);\n            }\n            else if (cell === Level.MONS) {\n                processMonster(env, level, col, row);\n            }\n            else if (cell === Level.EXP1) {\n                processExplosion1(env, level, col, row);\n            }\n            else if (cell === Level.EXP2) {\n                processExplosion2(env, level, col, row);\n            }\n        }\n    }\n    heroMoves.forEach(function(move) {\n        var col = move[0];\n        var row = move[1];\n        var vx = level.getVX(col, row);\n        var vy = level.getVY(col, row);\n        col += vx;\n        row += vy;\n        var cell = level.getType(col, row);\n        if (cell === Level.DUST) {\n            level.setType(col, row, Level.VOID);\n        }\n        else if (cell === Level.DIAM) {\n            env.eatDiam();\n            level.setType(col, row, Level.VOID);\n        }\n        else if (cell === Level.EXIT) env.nextLevel();\n        else if (cell !== Level.VOID) env.killHero();\n    });\n\n}\n\n// Appliquer les déplacements de chaque cellule.\nfunction apply(env) {\n    var level = env.level;\n    var row, col;\n    var isHeroAlive = false;\n    for (row = 0; row < level.rows; row++) {\n        for (col = 0; col < level.cols; col++) {\n            if (level.getType(col, row) === Level.HERO) isHeroAlive = true;\n            if (level.hasFlag(col, row)) {\n                // Cellule avec un flag : il ne faut pas la traiter.\n                level.unflag(col, row);\n                continue;\n            }\n            var vx = level.getVX(col, row);\n            var vy = level.getVY(col, row);\n            if (vx != 0 || vy != 0) {\n                level.move(col, row, col + vx, row + vy);\n                if (vx > 0 || vy > 0) {\n                    // On  flag une  cellule  si  elle est  à  droite ou  en\n                    // dessous de  la cellule courante.  Cela  évitera de la\n                    // prendre  en compte  une  deuxième fois  dans le  même\n                    // cycle.\n                    level.flag(col + vx, row + vy);\n                }\n            }\n        }\n    }\n    if (!isHeroAlive) env.killHero();\n}\n\nfunction createEnv(gl, assets): IEnvironment {\n    return {\n        gl: gl,\n        assets: assets,\n        x: 0, y: 0, z: 0, w: 1,\n        cellTime: 150,  // Temps en ms pour traverser une cellule.\n        nextSynchro: -1,\n        levelNumber: 0,\n        score: 0,\n        bonus: 0,\n        divDiam: document.getElementById(\"diam\"),\n        divScore: document.getElementById(\"score\"),\n        //#(eatDiam)\n        eatenDiams: 0,\n        eatDiam: function() {\n            // Les assets finissant par 'ogg', 'mp3' ou 'wav'\n            // sont transpformés en tag AUDIO.\n            assets.diamSound.pause();\n            // Il n'existe pas de méthode `stop()`.\n            // On doit donc faire une pause, puis\n            // remettre le curseur au début de la piste.\n            assets.diamSound.currentTime = 0;\n            assets.diamSound.play();\n            this.eatenDiams++;\n            console.log(this.eatenDiams, \"/\", this.level.need);\n            if (this.eatenDiams == this.level.need) {\n                this.level.setType(this.level.exitX, this.level.exitY, Level.EXIT);\n                assets.exitSound.play();\n            }\n            this.score += 50;\n            if (this.divDiam) {\n                this.divDiam.textContent = Math.max(0, this.level.need - this.eatenDiams);\n                this.divScore.textContent = this.score;\n            }\n        },\n        // Bruit du rocher dont la chute est stoppée par un obstacle.\n        playBoom: function() {\n            assets.rockSound.pause();\n            assets.rockSound.currentTime = 0;\n            assets.rockSound.play();\n        },\n        explode: function(col, row, makeDiams) {\n            var level = this.level;\n            var x, y;\n            this.makeDiams = makeDiams;\n            for (y = row - 1; y < row + 2; y++) {\n                for (x = col - 1; x < col + 2; x++) {\n                    if (level.getType(x, y) !== Level.WALL && level.getType(x, y) !== Level.EXIT) {\n                        level.setType(x, y, makeDiams ? Level.EXP2 : Level.EXP1);\n                        level.setIndex(x, y, 1);\n                        level.setMove(x, y, 0, 0);\n                    }\n                }\n            }\n            assets.explSound.pause();\n            assets.explSound.currentTime = 0;\n            assets.explSound.play();\n        },\n        // Vie te mort du Héro.\n        isHeroAlive: true,\n        killHero: function() {\n            if (!this.isHeroAlive) return;\n\n            this.camVX = this.camVY = 0;\n\n            this.isHeroAlive = false;\n            var col, row;\n            for (row = 0; row < this.level.rows; row++) {\n                for (col = 0; col < this.level.cols; col++) {\n                    if (this.level.getType(col, row) === Level.HERO) {\n                        this.explode(col, row);\n                    }\n                }\n            }\n            this.wait = 10;\n            if (this.isLevelDone) {\n                Message.show(\"Well done!\", true);\n            } else {\n                Message.show(\"Ouch!\");\n            }\n        },\n        isLevelDone: false,\n        nextLevel: function() {\n            this.isLevelDone = true;\n            this.killHero();\n        }\n    };\n}\n","import WebGL from \"./webgl\"\nimport { IEnvironment } from \"../types\"\n\n/**\n * @param env.gl\n * @param env.assets\n * @param env.cave\n */\nexport default class RainPainter {\n    constructor(env: IEnvironment) {\n        this._env = env;\n        var data = getData();\n        console.info(\"[rain-painter] data=\", data);\n        this._count = data.length / 6;\n        this._buffVert = WebGL.fillArrayBuffer(env.gl, new Float32Array(data));\n\n        this._prg = new WebGL.Program(env.gl, {\n            vert: env.assets.rainVert,\n            frag: env.assets.rainFrag\n        });\n\n        this._texture = createTexture(env.gl, env.assets.diamTexture);\n    }\n\n    //#(destroy)\n    destroy() {\n        var prg = this._prg;\n        var gl = prg.gl;\n        gl.deleteTexture(this._texture);\n        gl.deleteBuffer(this._buffVert);\n        prg.destroy();\n    }\n    //#(destroy)\n\n    // Pousser le VertexArray dans la carte graphique.\n    update() {\n        var env = this._env;\n        var gl = env.gl;\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._buffVert);\n        gl.bufferData(gl.ARRAY_BUFFER, env.level.data, gl.STATIC_DRAW);\n    }\n\n    //#(draw)\n    /**\n     * @param env.gl\n     * @param env.assets\n     * @param env.cave\n     * @param env.time\n     * @param env.width\n     * @param env.height\n     */\n    draw(env) {\n        var gl = env.gl;\n        var prg = this._prg;\n\n        prg.use();\n        // Dimensions de l'écran physique.\n        prg.$uniTime = env.time;\n        // Assignation de la texture.\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._texture);\n        prg.$uniTexture = 0;\n        // Attributs.\n        prg.bindAttribs(this._buffVert, \"attX\", \"attY\", \"attZ\", \"attW\", \"attSpeed\", \"attIndex\");\n        // Dessin.\n        gl.drawArrays(gl.POINTS, 0, this._count);\n    }\n    //#(draw)\n}\n\n//#(createTexture)\nfunction createTexture(gl, img) {\n    var texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    // On charge l'image dans la texture de la carte graphique.\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);\n    return texture;\n}\n//#(createTexture)\n\nfunction getData() {\n    var data = [];\n    var k, z, radius;\n    for (z = 1; z > .5; z -= 0.05) {\n        radius = 2 / z;\n        for (k = 0; k < 50; k++) {\n            data.push(\n                radius * Math.random() - radius / 2,  // X\n                radius * Math.random() - radius / 2,  // Y\n                z, // Z\n                1 / z, // W\n                Math.random(), // Speed\n                Math.random() // Index\n            );\n        }\n    }\n    return data;\n}\n","import WebGL from \"./webgl\"\nimport Level from \"./level\"\n\n  /**\n   * @param env.gl\n   * @param env.assets\n   * @param env.level\n   */\nexport default class WallPainter {\n    constructor( env, wallTexture ) {\n    var level = env.level.clone();\n    var arrays = getArrays( level );\n    var vertexArray = arrays.vertex;\n    var elementArray = arrays.element;\n\n    this._count = elementArray.length;\n    this._buffVert = WebGL.fillArrayBuffer( env.gl, new Float32Array( vertexArray ) );\n    this._buffElem = WebGL.fillElementBuffer( env.gl, new Uint16Array( elementArray ) );\n\n    this._prg = new WebGL.Program( env.gl, {\n      vert: env.assets.wallVert,\n      frag: env.assets.wallFrag\n    }, {\n      coords: env.assets.coordsVert\n    });\n\n    this._texture = createTexture( env.gl, wallTexture );\n  }\n\n  destroy() {\n    var prg = this._prg;\n    var gl = prg.gl;\n    gl.deleteTexture( this._texture );\n    gl.deleteBuffer( this._buffVert );\n    gl.deleteBuffer( this._buffElem );\n    prg.destroy();\n  }\n\n  //#(draw)\n  /**\n   * @param env.gl\n   * @param env.assets\n   * @param env.level\n   * @param env.time\n   * @param env.width\n   * @param env.height\n   */\n draw( env ) {\n    var gl = env.gl;\n    var prg = this._prg;\n\n    prg.use();\n    // Dimensions de l'écran physique.\n    prg.$uniWidth = env.width;\n    prg.$uniHeight = env.height;\n    prg.$uniX = env.x;\n    prg.$uniY = env.y;\n    prg.$uniZ = env.z;\n    prg.$uniW = env.w;\n    // Assignation de la texture.\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this._texture );\n    prg.$texture = 0;\n    // Attributs.\n    prg.bindAttribs( this._buffVert, \"attX\", \"attY\" );\n    // Dessin.\n    gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, this._buffElem );\n    gl.drawElements( gl.TRIANGLES, this._count, gl.UNSIGNED_SHORT, 0 );\n  }\n  //#(draw)\n}\n\n  //#(createTexture)\n  function createTexture( gl, img ) {\n    var texture = gl.createTexture( );\n    gl.bindTexture( gl.TEXTURE_2D, texture );\n    // Pour pouvoir utiliser gl.REPEAT, il faut obligatoirement\n    // que les dimensions de la texture soient en puissance de 2.\n    // Par exemple, 64x64, 128x128, 256x256, 512x512, ...\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT );\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT );\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR );\n    gl.texParameteri( gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR );\n    // On charge l'image dans la texture de la carte graphique.\n    gl.texImage2D( gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img );\n    return texture;\n  }\n  //#(createTexture)\n\n  //#(getArrays)\n  function getArrays( level ) {\n    var cache = {};\n    var rows = level.rows;\n    var cols = level.cols;\n    var col, row;\n    var vertexArray = [];\n    var elementArray = [];\n\n    function addVertex( col, row ) {\n      var key = row + \"-\" + col;\n      var idx = cache[key];\n      if( typeof idx === 'undefined' ) {\n        // C'est un nouveau vertex.\n        idx = Math.floor( vertexArray.length / 2 );\n        vertexArray.push( col - .5, row - .5 );\n        cache[key] = idx;\n      }\n      elementArray.push( idx );\n    }\n\n    var ww, hh;\n    for( row = 0; row < rows; row++ ) {\n      for( col = 0; col < cols; col++ ) {\n        if( level.getType( col, row ) === Level.WALL ) {\n          var countRight = countWallToRight( level, col, row );\n          var countBottom = countWallToBottom( level, col, row );\n          if( countRight > countBottom ) {\n            ww = countRight;\n            hh = 1;\n          } else {\n            ww = 1;\n            hh = countBottom;\n          }\n          addVertex( col, row );\n          addVertex( col + ww, row );\n          addVertex( col + ww, row + hh );\n          addVertex( col, row );\n          addVertex( col, row + hh );\n          addVertex( col + ww, row + hh );\n          clear( level, col, row, hh, ww );\n        }\n      }\n    }\n\n    return {\n      vertex: vertexArray, element: elementArray\n    };\n  }\n\n  function countWallToRight( level, col, row ) {\n    var count = 1;\n    col++;\n    while( col < level.cols ) {\n      if( level.getType( col, row ) !== Level.WALL ) break;\n      col++;\n      count++;\n    }\n    return count;\n  }\n\n  function countWallToBottom( level, col, row ) {\n    var count = 1;\n    row++;\n    while( row < level.rows ) {\n      if( level.getType( col, row ) !== Level.WALL ) break;\n      row++;\n      count++;\n    }\n    return count;\n  }\n\n  function clear( level, cc, rr, hh, ww ) {\n    var row, col;\n    for( row = rr ; row < rr + hh ; row++ ) {\n      for( col = cc ; col < cc + ww ; col++ ) {\n        level.setType( col, row, Level.VOID );\n      }\n    }\n  }\n","import WebGL from \"./webgl\"\n\n/**\n * @param env.gl\n * @param env.assets\n * @param env.cave\n */\nexport default class LevelPainter {\n    constructor(env) {\n        this._env = env;\n        this._count = env.level.data.length / 6;\n        this._buffVert = WebGL.fillArrayBuffer(env.gl, env.level.data);\n\n        this._prg = new WebGL.Program(env.gl, {\n            vert: env.assets.levelVert,\n            frag: env.assets.levelFrag\n        });\n\n        this._texture = createTexture(env.gl, env.assets.levelTexture);\n    }\n\n    destroy() {\n        var prg = this._prg;\n        var gl = prg.gl;\n        gl.deleteTexture(this._texture);\n        gl.deleteBuffer(this._buffVert);\n        prg.destroy();\n    }\n\n    // Pousser le VertexArray dans la carte graphique.\n    update() {\n        var env = this._env;\n        var gl = env.gl;\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._buffVert);\n        gl.bufferData(gl.ARRAY_BUFFER, env.level.data, gl.STATIC_DRAW);\n    }\n\n    /**\n     * @param env.gl\n     * @param env.assets\n     * @param env.cave\n     * @param env.time\n     * @param env.width\n     * @param env.height\n     */\n    draw(env) {\n        var gl = env.gl;\n        var prg = this._prg;\n\n        prg.use();\n        // Dimensions de l'écran physique.\n        prg.$uniTime = env.time;\n        prg.$uniWidth = env.width;\n        prg.$uniHeight = env.height;\n        prg.$uniX = env.x;\n        prg.$uniY = env.y;\n        prg.$uniZ = env.z;\n        prg.$uniW = env.w;\n        prg.$uniCellTime = env.cellTime;\n        // Assignation de la texture.\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._texture);\n        prg.$texture = 0;\n        // Attributs.\n        prg.bindAttribs(this._buffVert, \"attType\", \"attX\", \"attY\", \"attVX\", \"attVY\", \"attIndex\");\n        // Dessin.\n        gl.drawArrays(gl.POINTS, 0, this._count);\n    }\n}\n\nfunction createTexture(gl, img) {\n    var texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    // On charge l'image dans la texture de la carte graphique.\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);\n    return texture;\n}\n","import WebGL from \"./webgl\"\n\n/**\n * @param env.gl\n * @param env.assets\n * @param env.cave\n */\nexport default class BackgroundPainter {\n    constructor(env, backgroundTexture) {\n        var vertexArray = [-1, -1, +1, -1, -1, +1, +1, +1];\n        this._buffVert = WebGL.fillArrayBuffer(env.gl, new Float32Array(vertexArray));\n\n        this._prg = new WebGL.Program(env.gl, {\n            vert: env.assets.backgroundVert,\n            frag: env.assets.backgroundFrag\n        }, {\n                coords: env.assets.coordsVert\n            });\n\n        this._texture = createTexture(env.gl, backgroundTexture);\n    }\n\n    destroy() {\n        var prg = this._prg;\n        var gl = prg.gl;\n        gl.deleteTexture(this._texture);\n        gl.deleteBuffer(this._buffVert);\n        prg.destroy();\n    }\n\n    //#(draw)\n    /**\n     * @param env.gl\n     * @param env.assets\n     * @param env.cave\n     * @param env.time\n     * @param env.width\n     * @param env.height\n     */\n    draw(env) {\n        var gl = env.gl;\n        var prg = this._prg;\n\n        prg.use();\n        // Dimensions de l'écran physique.\n        prg.$uniWidth = env.width;\n        prg.$uniHeight = env.height;\n        prg.$uniX = env.x;\n        prg.$uniY = env.y;\n        prg.$uniZ = env.z;\n        prg.$uniW = env.w;\n        // Assignation de la texture.\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._texture);\n        prg.$texture = 0;\n        // Attributs.\n        prg.bindAttribs(this._buffVert, \"attX\", \"attY\");\n        // Dessin.\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    }\n    //#(draw)\n}\n\n//#(createTexture)\nfunction createTexture(gl, img) {\n    var texture = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    // On charge l'image dans la texture de la carte graphique.\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);\n    return texture;\n}\n","import WebGL from \"./webgl\"\n\n//#(tinter)\nclass Tinter {\n    private _prg: {};\n    private _buffVert: {};\n    private _texture: WebGLTexture;\n    private _gl: WebGLRenderingContext;\n\n    constructor(vert: string, frag: string) {\n        var canvas = document.createElement(\"canvas\");\n        var gl = canvas.getContext(\"webgl\", { preserveDrawingBuffer: true });\n        this._prg = new WebGL.Program(gl, { vert: vert, frag: frag });\n        // Les coordonnées UV de la texture.\n        var vertexArray = [0, 0, 1, 0, 0, 1, 1, 1];\n        this._buffVert = WebGL.fillArrayBuffer(gl, new Float32Array(vertexArray));\n\n        this._texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this._texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n        this._canvas = canvas;\n        this._gl = gl;\n    }\n\n    // Prend en entrée une image et une valeur comprise entre 0 et 359.\n    // Retourne un canvas avec l'image en question après décalage de\n    // sa teinte.\n    shiftHue(img, shift) {\n        // Soyons sûr d'avoir un paramètre correct en entrée.\n        if (typeof shift !== 'number' || isNaN(shift)) return img;\n\n        var canvas = this._canvas;\n        var prg = this._prg;\n        var gl = this._gl;\n\n        prg.use();\n        // Appliquer la taille de l'image à notre canvas.\n        var width = img.width;\n        var height = img.height;\n        canvas.setAttribute(\"width\", width);\n        canvas.setAttribute(\"height\", height);\n        gl.viewport(0, 0, width, height);\n\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n        // Charger la texture avec l'image courante.\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._texture);\n        prg.$uniTexture = 0;\n        // Définir le décalage de teinte.\n        prg.$uniHueShift = shift;\n        // Attributs.\n        prg.bindAttribs(this._buffVert, \"attX\", \"attY\");\n        // Dessin du rectangle.\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n        // Créer le canvas à retourner. Il a la même taille\n        // que l'image d'entrée.\n        var output = document.createElement(\"canvas\");\n        output.setAttribute(\"width\", width);\n        output.setAttribute(\"height\", height);\n        // Un context 2D suffit.\n        var ctx = output.getContext(\"2d\");\n        ctx.clearRect(0, 0, width, height);\n        // On y copie le contenu actuel du canvas WebGL.\n        ctx.drawImage(canvas, 0, 0, width, height);\n\n        return output;\n    }\n\n    // Pour faire le ménage.\n    destroy() {\n        var prg = this._prg;\n        var gl = prg.gl;\n        gl.deleteTexture(this._texture);\n        gl.deleteBuffer(this._buffVert);\n        prg.destroy();\n    }\n    //#(tinter)\n}\n\nconst f = function(assets, tint) {\n    if (typeof tint === 'undefined') tint = {};\n\n    var canvas = document.createElement(\"canvas\");\n    canvas.setAttribute(\"width\", 1024);\n    canvas.setAttribute(\"height\", 384);\n    var ctx = canvas.getContext(\"2d\");\n\n    var tinter = new Tinter(assets.hueVert, assets.hueFrag);\n    ctx.drawImage(assets.heroTexture, 0, 0);\n    ctx.drawImage(tinter.shiftHue(assets.boulderTexture, tint.rock), 0, 64);\n    ctx.drawImage(tinter.shiftHue(assets.diamTexture, tint.diam), 0, 128);\n    ctx.drawImage(tinter.shiftHue(assets.groundTexture, tint.dust), 0, 192);\n    ctx.drawImage(tinter.shiftHue(assets.exitTexture, tint.exit), 80, 192);\n    ctx.drawImage(tinter.shiftHue(assets.exploTexture, tint.expl), 512, 192);\n    ctx.drawImage(tinter.shiftHue(assets.monsterTexture, tint.mons), 0, 320);\n    tinter.destroy();\n\n    // Retourner le héro image par image.\n    ctx.scale(-1, 1);\n    for (var k = 0; k < 8; k++) {\n        ctx.drawImage(\n            assets.heroTexture, 64 * k, 0, 64, 64,\n            -576 - 64 * k, 0, 64, 64);\n    }\n\n    return canvas;\n};\nf.Tinter = Tinter;\n\nexport default f;\n","import Level from \"./level\"\nimport Levels from \"./levels\"\nimport HighScore from \"./high-score\"\nimport Transition from \"./transition\"\nimport GameInputs from \"./game-inputs\"\nimport LevelLogic from \"./level-logic\"\nimport RainPainter from \"./rain-painter\"\nimport WallPainter from \"./wall-painter\"\nimport LevelPainter from \"./level-painter\"\nimport BackgroundPainter from \"./background-painter\"\nimport TextureAggregator from \"./texture-aggregator\"\n\nimport { IAssets, IEnvironment } from \"../types\"\n\nimport Gamepad from \"./gamepad\"\n\n\nfunction go(assets: IAssets) {\n    const divName: HTMLInputElement = getById(\"name\") as HTMLInputElement;\n    const divNewScore: HTMLElement = getById(\"new-score\");\n    const divCongrat: HTMLElement = getById(\"congrat\");\n    const divWelcome: HTMLElement = getById(\"welcome\");\n    const divBonus: HTMLElement = getById(\"bonus\");\n    const canvas: HTMLCanvasElement = getById(\"canvas\") as HTMLCanvasElement;\n    const gl = canvas.getContext(\"webgl\");\n    if (!gl) return;\n    const env: IEnvironment = LevelLogic.createEnv(gl, assets);\n    console.info(\"env=\", env);\n\n    initLevel(env, parseInt(location.search.substr(1)));\n\n    gl.clearColor(0, 0, 0, 1);\n    gl.enable(gl.DEPTH_TEST);\n    gl.clearDepth(0);\n    gl.depthFunc(gl.GREATER);\n\n    var rainPainter = new RainPainter(env);\n    var transition = new Transition(gl, assets);\n    var highscore = new HighScore();\n\n    env.demoMode = true;\n    refreshHighScores(highscore);\n    var onStart = function() {\n        hideHighScores();\n        transition.start(function() {\n            env.demoMode = false;\n            initLevel(env, parseInt(location.search.substr(1)));\n        }, 1000);\n    };\n\n    onClick(\"btnStart\", onStart);\n    onClick(\"btnOk\", function() {\n        var name = divName.value.trim();\n        if (name.length === 0) {\n            divName.focus();\n            return;\n        }\n        var newScore = parseInt(divNewScore.textContent);\n        highscore.addScore(name, newScore);\n        divCongrat.className = \"hide\";\n        refreshHighScores(highscore);\n        env.demoMode = true;\n    });\n\n    function anim(time) {\n        window.requestAnimationFrame(anim);\n\n        var action = GameInputs.action;\n        if (env.demoMode) {\n            if (action === GameInputs.START) {\n                if (divCongrat.className != \"hide\") {\n                    onStart();\n                }\n                else if (divWelcome.className != \"hide\") {\n                    onStart();\n                }\n            }\n            action = GameInputs.STILL;\n        }\n\n        env.time = time;\n        var width = canvas.clientWidth;\n        var height = canvas.clientHeight;\n        canvas.setAttribute(\"width\", width);\n        canvas.setAttribute(\"height\", height);\n        env.width = width;\n        env.height = height;\n        env.w = Math.min(width, height) < 481 ? 2 : 1;\n        gl.viewport(0, 0, width, height);\n\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n        transition.draw(time, width, height);\n\n        if (env.demoMode) {\n            // Animation d'attente pendant l'affichage des HighScores.\n            rainPainter.draw(env);\n        }\n        else {\n            //#(synchro)\n            // A la synchro, on fait les calculs de mouvements.\n            if (env.nextSynchro < 0) {\n                env.nextSynchro = Math.ceil(time / env.cellTime) * env.cellTime;\n            }\n            else if (time >= env.nextSynchro) {\n                env.nextSynchro = Math.ceil(time / env.cellTime) * env.cellTime;\n\n                LevelLogic.apply(env);\n                LevelLogic.process(env, action);\n                env.levelPainter.update();\n\n                env.bonus--;\n                if (env.bonus === 0) env.killHero();\n                divBonus.textContent = env.bonus;\n\n                if (env.wait > -1) {\n                    env.wait--;\n                    if (env.wait <= 0) {\n                        if (env.isLevelDone) {\n                            transition.start(function() {\n                                env.score += env.bonus;\n                                initLevel(env, env.levelNumber + 1);\n                            }, 1200);\n                        } else {\n                            env.life--;\n                            if (env.life <= 0) {\n                                addNewScore(highscore, env.score);\n                                env.levelNumber = 0;\n                                env.demoMode = true;\n                            } else {\n                                initLevel(env, env.levelNumber);\n                            }\n                        }\n                        env.wait = -1;\n                    }\n                }\n            }\n            //#(synchro)\n\n            //#(camera)\n            // Positionner la caméra sur le héro.\n            // Sauf si le cadrage arrive hors tableau.\n            var t = (time % env.cellTime) / env.cellTime;\n            if (env.level.cols * 64 / env.w < width) {\n                env.x = env.level.cols / 2;\n            } else {\n                env.x = Math.min(\n                    Math.max(\n                        env.camX + t * env.camVX,\n                        width * env.w * .5 / 64\n                    ),\n                    env.level.cols - 1 - width * env.w * .5 / 64\n                );\n            }\n            if (env.level.rows * 64 / env.w < height) {\n                env.y = env.level.rows / 2;\n            } else {\n                env.y = Math.min(\n                    Math.max(\n                        env.camY + t * env.camVY,\n                        height * env.w * .5 / 64\n                    ),\n                    env.level.rows - 1 - height * env.w * .5 / 64\n                );\n            }\n            //#(camera)\n\n            // On affiche tout.\n            env.levelPainter.draw(env);\n            env.z = 0.2;\n            env.wallPainter.draw(env);\n            env.z = 0;\n            env.backgroundPainter.draw(env);\n        }\n    }\n    window.requestAnimationFrame(anim);\n}\n\n\nfunction initLevel(env, levelNumber) {\n    if (typeof levelNumber !== 'number' || isNaN(levelNumber)) levelNumber = 0;\n    if (levelNumber === 0) {\n        env.life = 3;\n        env.score = 0;\n    }\n    levelNumber %= Levels.length;\n    if (env.backgroundPainter) env.backgroundPainter.destroy();\n    if (env.wallPainter) env.wallPainter.destroy();\n    if (env.levelPainter) env.levelPainter.destroy();\n\n    var level = new Level(Levels[levelNumber]);\n    console.info(\"[script] level.tint=\", level.tint);\n    env.assets.levelTexture = TextureAggregator(env.assets, level.tint);\n\n    env.level = level;\n    env.camX = level.cols / 2;\n    env.camY = level.rows / 2;\n    env.camVX = 0;\n    env.camVY = 0;\n    env.eatenDiams = 0;\n    env.nextSynchro = -1;\n    env.isHeroAlive = true;\n    env.isLevelDone = false;\n    env.bonus = level.cols * level.rows * 4;\n    env.wait = -1;\n    env.levelNumber = levelNumber;\n\n    env.assets.musicSound.pause();\n    env.assets.musicSound.currentTime = 0;\n    env.assets.musicSound.play();\n\n    var tinter = new TextureAggregator.Tinter(env.assets.hueVert, env.assets.hueFrag);\n    var backgroundTexture = env.assets.backgroundTexture;\n    env.backgroundPainter = new BackgroundPainter(env, tinter.shiftHue(backgroundTexture, level.tint.void));\n    var wallTexture = env.assets.wallTexture;\n    env.wallPainter = new WallPainter(env, tinter.shiftHue(wallTexture, level.tint.wall));\n    env.levelPainter = new LevelPainter(env);\n\n    document.getElementById(\"diam\").textContent = level.need;\n    document.getElementById(\"life\").textContent = env.life;\n    document.getElementById(\"score\").textContent = env.score;\n    document.getElementById(\"bonus\").textContent = env.bonus;\n\n    return level;\n}\n\n\nfunction addNewScore(highscore, score) {\n    if (highscore.isAnHighScore(score)) {\n        var divCongrat = divCongrat;\n        divCongrat.className = \"\";\n        divNewScore.textContent = \"\" + score;\n        divName.focus();\n    } else {\n        refreshHighScores(highscore);\n    }\n}\n\n\nfunction refreshHighScores(highscore) {\n    var div = document.getElementById(\"highscores\");\n    div.innerHTML = \"\";\n    var scores = highscore.getScores();\n    scores.forEach(function(item, pos) {\n        var name = item[0];\n        var score = item[1];\n        var row = document.createElement(\"div\");\n        div.appendChild(row);\n        if (pos == highscore.getLastHighScoreIndex()) {\n            row.className = \"highlighted\";\n        }\n        var cell1 = document.createElement(\"div\");\n        cell1.textContent = name;\n        var cell2 = document.createElement(\"div\");\n        cell2.textContent = score;\n        row.appendChild(cell1);\n        row.appendChild(cell2);\n    });\n    showHighScores();\n}\n\n\nfunction showHighScores() {\n    const elem = document.getElementById(\"welcome\");\n    if (elem) elem.className = \"\";\n}\n\n\nfunction hideHighScores() {\n    const elem = document.getElementById(\"welcome\");\n    if (elem) elem.className = \"hide\";\n}\n\n\nfunction onClick(id: string, handler: () => void) {\n    const element = document.getElementById(id);\n    if (!element) {\n        throw Error(`No element found with id=\"${id}\"!`);\n    }\n    element.addEventListener(\"click\", handler);\n}\n\n\nfunction getById(id: string): HTMLElement {\n    const elem = document.getElementById(id);\n    if (!elem) {\n        throw Error(`Unable to find element with id=\"${id}\"!`);\n    }\n    return elem;\n}\n\nexport default { go };\n"],"sourceRoot":""}
{"ast":null,"code":"import \"./webgl.css\";\n\nvar WebGL = function () {\n  function endsWith(text) {\n    text = text.trim().toLowerCase();\n    var arg;\n\n    for (var i = 1; i < arguments.length; i++) {\n      arg = arguments[i].toLowerCase();\n      if (text.substr(text.length - arg.length) == arg) return true;\n    }\n\n    return false;\n  }\n\n  function Program(gl, codes, includes) {\n    if (typeof codes.vert !== 'string') {\n      throw Error('[webgl.program] Missing attribute `vert` in argument `codes`!');\n    }\n\n    if (typeof codes.frag !== 'string') {\n      throw Error('[webgl.program] Missing attribute `frag` in argument `codes`!');\n    }\n\n    codes = parseIncludes(codes, includes);\n    this.gl = gl;\n    Object.freeze(this.gl);\n    this._typesNamesLookup = getTypesNamesLookup(gl);\n    var shaderProgram = gl.createProgram();\n    var shaderVert = getVertexShader(gl, codes.vert);\n    var shaderFrag = getFragmentShader(gl, codes.frag);\n    gl.attachShader(shaderProgram, shaderVert);\n    gl.attachShader(shaderProgram, shaderFrag);\n    gl.linkProgram(shaderProgram);\n    /*\n      gl.detachShader( shaderProgram, shaderVert );\n      gl.deleteShader( shaderVert );\n      gl.detachShader( shaderProgram, shaderFrag );\n      gl.deleteShader( shaderFrag );\n    */\n\n    this.program = shaderProgram;\n    Object.freeze(this.program);\n    this.use();\n    createAttributes(this, gl, shaderProgram);\n    createUniforms(this, gl, shaderProgram);\n  }\n\n  Program.prototype.destroy = function () {\n    this.gl.deleteProgram(this.program);\n  };\n\n  Program.prototype.use = function () {\n    this.gl.useProgram(this.program);\n  };\n\n  Program.prototype.getTypeName = function (typeId) {\n    return this._typesNamesLookup[typeId];\n  };\n\n  var BPE = new Float32Array().BYTES_PER_ELEMENT;\n\n  Program.prototype.bindAttribs = function (buffer) {\n    this.use();\n    var gl = this.gl;\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    var names = Array.prototype.slice.call(arguments, 1);\n    var totalSize = 0;\n    names.forEach(function (name) {\n      var attrib = this.attribs[name];\n\n      if (!attrib) {\n        throw \"Cannot find attribute \\\"\" + name + \"\\\"!\\n\" + \"It may be not active because unused in the shader.\\n\" + \"Available attributes are: \" + Object.keys(this.attribs).map(function (name) {\n          return '\"' + name + '\"';\n        }).join(\", \");\n      }\n\n      totalSize += attrib.size * attrib.length * BPE;\n    }, this);\n    var offset = 0;\n    names.forEach(function (name) {\n      var attrib = this.attribs[name];\n      gl.enableVertexAttribArray(attrib.location);\n      gl.vertexAttribPointer(attrib.location, attrib.size * attrib.length, gl.FLOAT, false, // No normalisation.\n      totalSize, offset);\n      offset += attrib.size * attrib.length * BPE;\n    }, this);\n  };\n\n  function createAttributes(that, gl, shaderProgram) {\n    var index, item;\n    var attribs = {};\n    var attribsCount = gl.getProgramParameter(shaderProgram, gl.ACTIVE_ATTRIBUTES);\n\n    for (index = 0; index < attribsCount; index++) {\n      item = gl.getActiveAttrib(shaderProgram, index);\n      item.typeName = that.getTypeName(item.type);\n      item.length = getSize.call(that, gl, item);\n      item.location = gl.getAttribLocation(shaderProgram, item.name);\n      console.info(\"item=\", item);\n      attribs[item.name] = item;\n    }\n\n    that.attribs = attribs;\n    Object.freeze(that.attribs);\n  }\n\n  function createAttributeSetter(gl, item, shaderProgram) {\n    console.info(\"item=\", item);\n    var name = item.name;\n    return function (v) {\n      if (typeof v !== 'boolean') {\n        throw \"[webgl.program::$\" + name + \"] Value must be a boolean: true if you want to enable this attribute, and false to disable it.\";\n      }\n\n      if (v) {\n        console.log(\"enableVertexAttribArray(\", gl.getAttribLocation(shaderProgram, name), \")\");\n        gl.enableVertexAttribArray(gl.getAttribLocation(shaderProgram, name));\n      } else {\n        gl.disableVertexAttribArray(gl.getAttribLocation(shaderProgram, name));\n      }\n    };\n  }\n\n  function createAttributeGetter(gl, item, shaderProgram) {\n    var loc = gl.getAttribLocation(shaderProgram, item.name);\n    return function () {\n      return loc;\n    };\n  }\n\n  function createUniforms(that, gl, shaderProgram) {\n    var index, item;\n    var uniforms = {};\n    var uniformsCount = gl.getProgramParameter(shaderProgram, gl.ACTIVE_UNIFORMS);\n\n    for (index = 0; index < uniformsCount; index++) {\n      item = gl.getActiveUniform(shaderProgram, index);\n      uniforms[item.name] = gl.getUniformLocation(shaderProgram, item.name);\n      Object.defineProperty(that, '$' + item.name, {\n        set: createUniformSetter(gl, item, uniforms[item.name], that._typesNamesLookup),\n        get: createUniformGetter(item),\n        enumerable: true,\n        configurable: false\n      });\n    }\n\n    that.uniforms = uniforms;\n    Object.freeze(that.uniforms);\n  }\n  /**\n   * This is a preprocessor for shaders.\n   * Directives  `#include`  will be  replaced  by  the content  of  the\n   * correspondent attribute in `includes`.\n   */\n\n\n  function parseIncludes(codes, includes) {\n    var result = {};\n    var id, code;\n\n    for (id in codes) {\n      code = codes[id];\n      result[id] = code.split('\\n').map(function (line) {\n        if (line.trim().substr(0, 8) != '#include') return line;\n        var pos = line.indexOf('#include') + 8;\n        var includeName = line.substr(pos).trim(); // We accept all this systaxes:\n        // #include foo\n        // #include 'foo'\n        // #include <foo>\n        // #include \"foo\"\n\n        if (\"'<\\\"\".indexOf(includeName.charAt(0)) > -1) {\n          includeName = includeName.substr(1, includeName.length - 2);\n        }\n\n        var snippet = includes[includeName];\n\n        if (typeof snippet !== 'string') {\n          console.error(\"Include <\" + includeName + \"> not found in \", includes);\n          throw Error(\"Include not found in shader: \" + includeName);\n        }\n\n        return snippet;\n      }).join(\"\\n\");\n    }\n\n    return result;\n  }\n\n  function createUniformSetter(gl, item, nameGL, lookup) {\n    var nameJS = '_$' + item.name;\n\n    switch (item.type) {\n      case gl.BYTE:\n      case gl.UNSIGNED_BYTE:\n      case gl.SHORT:\n      case gl.UNSIGNED_SHORT:\n      case gl.INT:\n      case gl.UNSIGNED_INT:\n      case gl.SAMPLER_2D:\n        // For textures, we specify the texture unit.\n        if (item.size == 1) {\n          return function (v) {\n            gl.uniform1i(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          return function (v) {\n            gl.uniform1iv(nameGL, v);\n            this[nameJS] = v;\n          };\n        }\n\n        break;\n\n      case gl.FLOAT:\n        if (item.size == 1) {\n          return function (v) {\n            gl.uniform1f(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          return function (v) {\n            gl.uniform1fv(nameGL, v);\n            this[nameJS] = v;\n          };\n        }\n\n        break;\n\n      case gl.FLOAT_VEC3:\n        if (item.size == 1) {\n          return function (v) {\n            gl.uniform3fv(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC3 in uniform `\" + item.name + \"'!'\");\n        }\n\n        break;\n\n      case gl.FLOAT_VEC4:\n        if (item.size == 1) {\n          return function (v) {\n            gl.uniform4fv(nameGL, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC4 in uniform `\" + item.name + \"'!'\");\n        }\n\n        break;\n\n      case gl.FLOAT_MAT3:\n        if (item.size == 1) {\n          return function (v) {\n            gl.uniformMatrix3fv(nameGL, false, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT3 in uniform `\" + item.name + \"'!'\");\n        }\n\n        break;\n\n      case gl.FLOAT_MAT4:\n        if (item.size == 1) {\n          return function (v) {\n            gl.uniformMatrix4fv(nameGL, false, v);\n            this[nameJS] = v;\n          };\n        } else {\n          throw Error(\"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT4 in uniform `\" + item.name + \"'!'\");\n        }\n\n        break;\n\n      default:\n        throw Error(\"[webgl.program.createWriter] Don't know how to deal with uniform `\" + item.name + \"` of type \" + lookup[item.type] + \"!\");\n    }\n  }\n\n  function createUniformGetter(item) {\n    var name = '_$' + item.name;\n    return function () {\n      return this[name];\n    };\n  }\n\n  function getShader(type, gl, code) {\n    var shader = gl.createShader(type);\n    gl.shaderSource(shader, code);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      console.log(code);\n      console.error(\"An error occurred compiling the shader: \" + gl.getShaderInfoLog(shader));\n      return null;\n    }\n\n    return shader;\n  }\n\n  function getFragmentShader(gl, code) {\n    return getShader(gl.FRAGMENT_SHADER, gl, code);\n  }\n\n  function getVertexShader(gl, code) {\n    return getShader(gl.VERTEX_SHADER, gl, code);\n  }\n\n  function getTypesNamesLookup(gl) {\n    var lookup = {};\n    var k, v;\n\n    for (k in gl) {\n      v = gl[k];\n\n      if (typeof v === 'number') {\n        lookup[v] = k;\n      }\n    }\n\n    return lookup;\n  }\n\n  function getSize(gl, item) {\n    switch (item.type) {\n      case gl.FLOAT_VEC4:\n        return 4;\n\n      case gl.FLOAT_VEC3:\n        return 3;\n\n      case gl.FLOAT_VEC2:\n        return 2;\n\n      case gl.FLOAT:\n        return 1;\n\n      default:\n        throw \"[webgl.program:getSize] I don't know the size of the attribute '\" + item.name + \"' because I don't know the type \" + this.getTypeName(item.type) + \"!\";\n    }\n  }\n\n  function fetchAssets(assets) {\n    return new Promise(function (resolve, reject) {\n      showSplashScreen().then(function () {\n        var count = 0;\n        var done = 0;\n\n        for (var key in assets) {\n          count++;\n        }\n\n        var progress = document.getElementById(\"PROGRESS\");\n        var result = {};\n\n        function next(url) {\n          done++;\n          var percent = done / count;\n          progress.style.transform = \"scaleX(\" + percent + \")\";\n          console.log(url, (100 * percent).toFixed(0) + \"%\");\n\n          if (done >= count) {\n            resolve(result);\n            hideSplashScreen();\n            return;\n          }\n        }\n\n        Object.keys(assets).forEach(function (key) {\n          var url = assets[key];\n\n          if (endsWith(url, \"jpg\", \"png\", \"gif\", \"svg\")) {\n            var img = new Image();\n            img.crossOrigin = \"anonymous\";\n            result[key] = img;\n            img.onload = next.bind(null, url);\n\n            img.onerror = function (ex) {\n              console.error(\"Unable to load image \\\"\" + key + \"\\\":\", url);\n              console.error(ex);\n              next(url);\n            };\n\n            img.src = url;\n          } else if (endsWith(url, \"ogg\", \"wav\", \"mp3\")) {\n            var audio = document.createElement(\"audio\");\n            result[key] = audio;\n\n            var slot = function slot() {\n              console.log(\"Slot for \", url);\n              if (audio._loaded) return;\n              audio._loaded = true;\n              console.log(\"Loaded: \", url);\n              next(url);\n            };\n\n            audio.addEventListener(\"canplay\", slot);\n            audio.addEventListener(\"loadeddata\", slot);\n            window.setTimeout(slot, 3000);\n            audio.addEventListener(\"error\", function (ex) {\n              console.error(\"Unable to load sound \\\"\" + key + \"\\\":\", url);\n              console.error(ex);\n              next(url);\n            });\n            audio.src = url;\n            console.log(\"Loading audio: \", url);\n          } else {\n            fetch(url).then(function (response) {\n              if (!response.ok) throw \"\";\n\n              if (endsWith(url, \"json\")) {\n                return response.json();\n              } else {\n                return response.text();\n              }\n            }).then(function (content) {\n              result[key] = content;\n              next(url);\n            }).catch(function (ex) {\n              console.error(\"Unable to fetch asset \\\"\" + key + \"\\\": \", url);\n              next(url);\n            });\n          }\n        });\n      });\n    });\n  }\n\n  function fillArrayBuffer(gl, vertices) {\n    if (!(gl instanceof WebGLRenderingContext) && !(gl instanceof WebGL2RenderingContext)) {\n      throw \"Le premier argument de WebGL.fillArrayBuffer doit obligatoirment être de type WebGLRenderingContext ou WebGL2RenderingContext !\";\n    }\n\n    if (!(vertices instanceof Float32Array)) {\n      throw \"Le second argument de WebGL.fillArrayBuffer doit obligatoirment être de type Float32Array !\";\n    }\n\n    var buff = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buff);\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n    return buff;\n  }\n\n  function fillElementBuffer(gl, elements) {\n    if (!(gl instanceof WebGLRenderingContext) && !(gl instanceof WebGL2RenderingContext)) {\n      throw \"Le premier argument de WebGL.fillArrayBuffer doit obligatoirment être de type WebGLRenderingContext ou WebGL2RenderingContext !\";\n    }\n\n    if (!(elements instanceof Uint16Array)) {\n      throw \"Le second argument de WebGL.fillArrayBuffer doit obligatoirment être de type Uint16Array !\";\n    }\n\n    var buff = gl.createBuffer();\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buff);\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, elements, gl.STATIC_DRAW);\n    return buff;\n  }\n\n  function newCanvas() {\n    var body = document.body;\n    var canvas = document.createElement(\"canvas\");\n    canvas.setAttribute(\"width\", body.clientWidth);\n    canvas.setAttribute(\"height\", body.clientHeight);\n    body.appendChild(canvas);\n    return canvas;\n  }\n\n  function showSplashScreen(applicationName) {\n    if (typeof applicationName === 'undefined') applicationName = 'TOLOKOBAN';\n    return new Promise(function (resolve, reject) {\n      function show() {\n        var splash = document.createElement(\"div\");\n        splash.setAttribute(\"id\", \"SPLASH\");\n        splash.innerHTML = \"<div>\" + applicationName + \"</div><div>\" + applicationName + \"</div>\";\n        document.body.appendChild(splash);\n        var progress = document.createElement(\"div\");\n        progress.setAttribute(\"id\", \"PROGRESS\");\n        document.body.appendChild(progress);\n        window.setTimeout(function () {\n          splash.setAttribute(\"class\", \"show\");\n        }, 50);\n        resolve();\n      }\n\n      if (document.readyState === \"complete\") {\n        show();\n      } else {\n        document.addEventListener(\"DOMContentLoaded\", show);\n      }\n    });\n  }\n\n  function hideSplashScreen() {\n    var splash = document.getElementById(\"SPLASH\");\n    splash.setAttribute(\"class\", \"hide\");\n    var progress = document.getElementById(\"PROGRESS\");\n    document.body.removeChild(progress);\n    window.setTimeout(function () {\n      document.body.removeChild(splash);\n    }, 500);\n  } //========================================================================================\n\n\n  return {\n    Program: Program,\n    fetchAssets: fetchAssets,\n    fillArrayBuffer: fillArrayBuffer,\n    fillElementBuffer: fillElementBuffer,\n    newCanvas: newCanvas\n  };\n}();\n\nexport default WebGL;","map":{"version":3,"sources":["/home/tolokoban/Code/github/boulder-dash/src/lib/webgl.ts"],"names":["WebGL","endsWith","text","trim","toLowerCase","arg","i","arguments","length","substr","Program","gl","codes","includes","vert","Error","frag","parseIncludes","Object","freeze","_typesNamesLookup","getTypesNamesLookup","shaderProgram","createProgram","shaderVert","getVertexShader","shaderFrag","getFragmentShader","attachShader","linkProgram","program","use","createAttributes","createUniforms","prototype","destroy","deleteProgram","useProgram","getTypeName","typeId","BPE","Float32Array","BYTES_PER_ELEMENT","bindAttribs","buffer","bindBuffer","ARRAY_BUFFER","names","Array","slice","call","totalSize","forEach","name","attrib","attribs","keys","map","join","size","offset","enableVertexAttribArray","location","vertexAttribPointer","FLOAT","that","index","item","attribsCount","getProgramParameter","ACTIVE_ATTRIBUTES","getActiveAttrib","typeName","type","getSize","getAttribLocation","console","info","createAttributeSetter","v","log","disableVertexAttribArray","createAttributeGetter","loc","uniforms","uniformsCount","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","defineProperty","set","createUniformSetter","get","createUniformGetter","enumerable","configurable","result","id","code","split","line","pos","indexOf","includeName","charAt","snippet","error","nameGL","lookup","nameJS","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","INT","UNSIGNED_INT","SAMPLER_2D","uniform1i","uniform1iv","uniform1f","uniform1fv","FLOAT_VEC3","uniform3fv","FLOAT_VEC4","uniform4fv","FLOAT_MAT3","uniformMatrix3fv","FLOAT_MAT4","uniformMatrix4fv","getShader","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","FRAGMENT_SHADER","VERTEX_SHADER","k","FLOAT_VEC2","fetchAssets","assets","Promise","resolve","reject","showSplashScreen","then","count","done","key","progress","document","getElementById","next","url","percent","style","transform","toFixed","hideSplashScreen","img","Image","crossOrigin","onload","bind","onerror","ex","src","audio","createElement","slot","_loaded","addEventListener","window","setTimeout","fetch","response","ok","json","content","catch","fillArrayBuffer","vertices","WebGLRenderingContext","WebGL2RenderingContext","buff","createBuffer","bufferData","STATIC_DRAW","fillElementBuffer","elements","Uint16Array","ELEMENT_ARRAY_BUFFER","newCanvas","body","canvas","setAttribute","clientWidth","clientHeight","appendChild","applicationName","show","splash","innerHTML","readyState","removeChild"],"mappings":"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","sourcesContent":["import \"./webgl.css\"\n\nconst WebGL = function() {\n  function endsWith( text ) {\n    text = text.trim().toLowerCase();\n    var arg;\n    for( var i=1; i<arguments.length; i++ ) {\n      arg = arguments[i].toLowerCase();\n      if( text.substr( text.length - arg.length ) == arg ) return true;\n    }\n    return false;\n  }\n\n  function Program( gl, codes, includes ) {\n    if ( typeof codes.vert !== 'string' ) {\n      throw Error( '[webgl.program] Missing attribute `vert` in argument `codes`!' );\n    }\n    if ( typeof codes.frag !== 'string' ) {\n      throw Error( '[webgl.program] Missing attribute `frag` in argument `codes`!' );\n    }\n\n    codes = parseIncludes( codes, includes );\n\n    this.gl = gl;\n    Object.freeze( this.gl );\n\n    this._typesNamesLookup = getTypesNamesLookup( gl );\n\n    var shaderProgram = gl.createProgram();\n    var shaderVert = getVertexShader( gl, codes.vert );\n    var shaderFrag = getFragmentShader( gl, codes.frag );\n    gl.attachShader( shaderProgram, shaderVert );\n    gl.attachShader( shaderProgram, shaderFrag );\n    gl.linkProgram( shaderProgram );\n    /*\n      gl.detachShader( shaderProgram, shaderVert );\n      gl.deleteShader( shaderVert );\n      gl.detachShader( shaderProgram, shaderFrag );\n      gl.deleteShader( shaderFrag );\n    */\n    this.program = shaderProgram;\n    Object.freeze( this.program );\n\n    this.use();\n    createAttributes( this, gl, shaderProgram );\n    createUniforms( this, gl, shaderProgram );\n  }\n\n  Program.prototype.destroy = function() {\n    this.gl.deleteProgram( this.program );\n  };\n\n  Program.prototype.use = function() {\n    this.gl.useProgram( this.program );\n  };\n\n  Program.prototype.getTypeName = function ( typeId ) {\n    return this._typesNamesLookup[ typeId ];\n  };\n\n  var BPE = ( new Float32Array() ).BYTES_PER_ELEMENT;\n\n  Program.prototype.bindAttribs = function ( buffer ) {\n    this.use();\n    var gl = this.gl;\n    gl.bindBuffer( gl.ARRAY_BUFFER, buffer );\n    var names = Array.prototype.slice.call( arguments, 1 );\n    var totalSize = 0;\n    names.forEach( function ( name ) {\n      var attrib = this.attribs[ name ];\n      if ( !attrib ) {\n        throw \"Cannot find attribute \\\"\" + name + \"\\\"!\\n\" +\n          \"It may be not active because unused in the shader.\\n\" +\n          \"Available attributes are: \" + Object.keys( this.attribs ).map( function ( name ) {\n            return '\"' + name + '\"';\n          } ).join( \", \" );\n      }\n      totalSize += ( attrib.size * attrib.length ) * BPE;\n    }, this );\n    var offset = 0;\n    names.forEach( function ( name ) {\n      var attrib = this.attribs[ name ];\n      gl.enableVertexAttribArray( attrib.location );\n      gl.vertexAttribPointer(\n        attrib.location,\n        attrib.size * attrib.length,\n        gl.FLOAT,\n        false, // No normalisation.\n        totalSize,\n        offset\n      );\n      offset += ( attrib.size * attrib.length ) * BPE;\n    }, this );\n  };\n\n  function createAttributes( that, gl, shaderProgram ) {\n    var index, item;\n    var attribs = {};\n    var attribsCount = gl.getProgramParameter( shaderProgram, gl.ACTIVE_ATTRIBUTES );\n    for ( index = 0; index < attribsCount; index++ ) {\n      item = gl.getActiveAttrib( shaderProgram, index );\n      item.typeName = that.getTypeName( item.type );\n      item.length = getSize.call( that, gl, item );\n      item.location = gl.getAttribLocation( shaderProgram, item.name );\n      console.info( \"item=\", item );\n      attribs[ item.name ] = item;\n    }\n\n    that.attribs = attribs;\n    Object.freeze( that.attribs );\n  }\n\n  function createAttributeSetter( gl, item, shaderProgram ) {\n    console.info( \"item=\", item );\n    var name = item.name;\n    return function ( v ) {\n      if ( typeof v !== 'boolean' ) {\n        throw \"[webgl.program::$\" + name +\n          \"] Value must be a boolean: true if you want to enable this attribute, and false to disable it.\";\n      }\n      if ( v ) {\n        console.log( \"enableVertexAttribArray(\", gl.getAttribLocation( shaderProgram, name ), \")\" );\n        gl.enableVertexAttribArray(\n          gl.getAttribLocation( shaderProgram, name )\n        );\n      } else {\n        gl.disableVertexAttribArray(\n          gl.getAttribLocation( shaderProgram, name )\n        );\n      }\n    };\n  }\n\n  function createAttributeGetter( gl, item, shaderProgram ) {\n    var loc = gl.getAttribLocation( shaderProgram, item.name );\n    return function () {\n      return loc;\n    };\n  }\n\n  function createUniforms( that, gl, shaderProgram ) {\n    var index, item;\n    var uniforms = {};\n    var uniformsCount = gl.getProgramParameter( shaderProgram, gl.ACTIVE_UNIFORMS );\n    for ( index = 0; index < uniformsCount; index++ ) {\n      item = gl.getActiveUniform( shaderProgram, index );\n      uniforms[ item.name ] = gl.getUniformLocation( shaderProgram, item.name );\n      Object.defineProperty( that, '$' + item.name, {\n        set: createUniformSetter( gl, item, uniforms[ item.name ], that._typesNamesLookup ),\n        get: createUniformGetter( item ),\n        enumerable: true,\n        configurable: false\n      } );\n    }\n    that.uniforms = uniforms;\n    Object.freeze( that.uniforms );\n  }\n\n  /**\n   * This is a preprocessor for shaders.\n   * Directives  `#include`  will be  replaced  by  the content  of  the\n   * correspondent attribute in `includes`.\n   */\n  function parseIncludes( codes, includes ) {\n    var result = {};\n    var id, code;\n    for ( id in codes ) {\n      code = codes[ id ];\n      result[ id ] = code.split( '\\n' ).map( function ( line ) {\n        if ( line.trim().substr( 0, 8 ) != '#include' ) return line;\n        var pos = line.indexOf( '#include' ) + 8;\n        var includeName = line.substr( pos ).trim();\n        // We accept all this systaxes:\n        // #include foo\n        // #include 'foo'\n        // #include <foo>\n        // #include \"foo\"\n        if ( \"'<\\\"\".indexOf( includeName.charAt( 0 ) ) > -1 ) {\n          includeName = includeName.substr( 1, includeName.length - 2 );\n        }\n        var snippet = includes[ includeName ];\n        if ( typeof snippet !== 'string' ) {\n          console.error( \"Include <\" + includeName + \"> not found in \", includes );\n          throw Error( \"Include not found in shader: \" + includeName );\n        }\n        return snippet;\n      } ).join( \"\\n\" );\n    }\n    return result;\n  }\n\n\n  function createUniformSetter( gl, item, nameGL, lookup ) {\n    var nameJS = '_$' + item.name;\n\n    switch ( item.type ) {\n    case gl.BYTE:\n    case gl.UNSIGNED_BYTE:\n    case gl.SHORT:\n    case gl.UNSIGNED_SHORT:\n    case gl.INT:\n    case gl.UNSIGNED_INT:\n    case gl.SAMPLER_2D: // For textures, we specify the texture unit.\n      if ( item.size == 1 ) {\n        return function ( v ) {\n          gl.uniform1i( nameGL, v );\n          this[ nameJS ] = v;\n        };\n      } else {\n        return function ( v ) {\n          gl.uniform1iv( nameGL, v );\n          this[ nameJS ] = v;\n        };\n      }\n      break;\n    case gl.FLOAT:\n      if ( item.size == 1 ) {\n        return function ( v ) {\n          gl.uniform1f( nameGL, v );\n          this[ nameJS ] = v;\n        };\n      } else {\n        return function ( v ) {\n          gl.uniform1fv( nameGL, v );\n          this[ nameJS ] = v;\n        };\n      }\n      break;\n    case gl.FLOAT_VEC3:\n      if ( item.size == 1 ) {\n        return function ( v ) {\n          gl.uniform3fv( nameGL, v );\n          this[ nameJS ] = v;\n        };\n      } else {\n        throw Error(\n          \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC3 in uniform `\" +\n            item.name + \"'!'\"\n        );\n      }\n      break;\n    case gl.FLOAT_VEC4:\n      if ( item.size == 1 ) {\n        return function ( v ) {\n          gl.uniform4fv( nameGL, v );\n          this[ nameJS ] = v;\n        };\n      } else {\n        throw Error(\n          \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_VEC4 in uniform `\" +\n            item.name + \"'!'\"\n        );\n      }\n      break;\n    case gl.FLOAT_MAT3:\n      if ( item.size == 1 ) {\n        return function ( v ) {\n          gl.uniformMatrix3fv( nameGL, false, v );\n          this[ nameJS ] = v;\n        };\n      } else {\n        throw Error(\n          \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT3 in uniform `\" +\n            item.name + \"'!'\"\n        );\n      }\n      break;\n    case gl.FLOAT_MAT4:\n      if ( item.size == 1 ) {\n        return function ( v ) {\n          gl.uniformMatrix4fv( nameGL, false, v );\n          this[ nameJS ] = v;\n        };\n      } else {\n        throw Error(\n          \"[webgl.program.createWriter] Don't know how to deal arrays of FLOAT_MAT4 in uniform `\" +\n            item.name + \"'!'\"\n        );\n      }\n      break;\n    default:\n      throw Error(\n        \"[webgl.program.createWriter] Don't know how to deal with uniform `\" +\n          item.name + \"` of type \" + lookup[ item.type ] + \"!\"\n      );\n    }\n  }\n\n  function createUniformGetter( item ) {\n    var name = '_$' + item.name;\n    return function () {\n      return this[ name ];\n    };\n  }\n\n\n  function getShader( type, gl, code ) {\n    var shader = gl.createShader( type );\n    gl.shaderSource( shader, code );\n    gl.compileShader( shader );\n    if ( !gl.getShaderParameter( shader, gl.COMPILE_STATUS ) ) {\n      console.log( code );\n      console.error( \"An error occurred compiling the shader: \" + gl.getShaderInfoLog( shader ) );\n      return null;\n    }\n\n    return shader;\n  }\n\n  function getFragmentShader( gl, code ) {\n    return getShader( gl.FRAGMENT_SHADER, gl, code );\n  }\n\n  function getVertexShader( gl, code ) {\n    return getShader( gl.VERTEX_SHADER, gl, code );\n  }\n\n  function getTypesNamesLookup( gl ) {\n    var lookup = {};\n    var k, v;\n    for ( k in gl ) {\n      v = gl[ k ];\n      if ( typeof v === 'number' ) {\n        lookup[ v ] = k;\n      }\n    }\n    return lookup;\n  }\n\n  function getSize( gl, item ) {\n    switch ( item.type ) {\n    case gl.FLOAT_VEC4:\n      return 4;\n    case gl.FLOAT_VEC3:\n      return 3;\n    case gl.FLOAT_VEC2:\n      return 2;\n    case gl.FLOAT:\n      return 1;\n    default:\n      throw \"[webgl.program:getSize] I don't know the size of the attribute '\" + item.name +\n        \"' because I don't know the type \" + this.getTypeName( item.type ) + \"!\";\n    }\n  }\n\n  function fetchAssets( assets ) {\n    return new Promise(function (resolve, reject) {\n      showSplashScreen().then(function() {\n        var count = 0;\n        var done = 0;\n        for( var key in assets ) count++;\n        var progress = document.getElementById(\"PROGRESS\");\n        var result = {};\n\n        function next( url ) {\n          done++;\n          var percent = done / count;\n          progress.style.transform = \"scaleX(\" + percent + \")\";\n          console.log( url, (100 * percent).toFixed(0) + \"%\");\n\n          if( done >= count ) {\n            resolve( result );\n            hideSplashScreen();\n            return;\n          }\n        }\n\n        Object.keys( assets ).forEach(function( key ) {\n          var url = assets[key];\n          if( endsWith( url, \"jpg\", \"png\", \"gif\", \"svg\" ) ) {\n            var img = new Image();\n            img.crossOrigin = \"anonymous\";\n            result[key] = img;\n            img.onload = next.bind(null, url);\n            img.onerror = function( ex ) {\n              console.error(\"Unable to load image \\\"\" + key + \"\\\":\", url);\n              console.error( ex );\n              next( url );\n            };\n            img.src = url;\n          } else if( endsWith( url, \"ogg\", \"wav\", \"mp3\" ) ) {\n            var audio = document.createElement(\"audio\");\n            result[key] = audio;\n            var slot = function() {\n              console.log( \"Slot for \", url );\n              if( audio._loaded ) return;\n              audio._loaded = true;\n              console.log( \"Loaded: \", url );\n              next( url );\n            };\n            audio.addEventListener( \"canplay\", slot );\n            audio.addEventListener( \"loadeddata\", slot );\n            window.setTimeout( slot, 3000 );\n            audio.addEventListener( \"error\", function( ex ) {\n              console.error(\"Unable to load sound \\\"\" + key + \"\\\":\", url);\n              console.error( ex );\n              next( url );\n            });\n            audio.src = url;\n            console.log(\"Loading audio: \", url);\n          } else {\n            fetch( url ).then(function(response) {\n              if( !response.ok ) throw \"\";\n              if( endsWith( url, \"json\" ) ) {\n                return response.json();\n              } else {\n                return response.text();\n              }\n            }).then(function(content) {\n              result[key] = content;\n              next( url );\n            }).catch(function(ex) {\n              console.error(\"Unable to fetch asset \\\"\" + key + \"\\\": \", url);\n              next( url );\n            });\n          }\n        });\n      });\n    });\n  }\n\n  function fillArrayBuffer( gl, vertices ) {\n    if( !(gl instanceof WebGLRenderingContext) && !(gl instanceof WebGL2RenderingContext) ) {\n      throw \"Le premier argument de WebGL.fillArrayBuffer doit obligatoirment être de type WebGLRenderingContext ou WebGL2RenderingContext !\";\n    }\n    if( !(vertices instanceof Float32Array) ) {\n      throw \"Le second argument de WebGL.fillArrayBuffer doit obligatoirment être de type Float32Array !\";\n    }\n\n    var buff = gl.createBuffer();\n    gl.bindBuffer( gl.ARRAY_BUFFER, buff );\n    gl.bufferData( gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW );\n    return buff;\n  }\n\n  function fillElementBuffer( gl, elements ) {\n    if( !(gl instanceof WebGLRenderingContext) && !(gl instanceof WebGL2RenderingContext) ) {\n      throw \"Le premier argument de WebGL.fillArrayBuffer doit obligatoirment être de type WebGLRenderingContext ou WebGL2RenderingContext !\";\n    }\n    if( !(elements instanceof Uint16Array) ) {\n      throw \"Le second argument de WebGL.fillArrayBuffer doit obligatoirment être de type Uint16Array !\";\n    }\n\n    var buff = gl.createBuffer();\n    gl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, buff );\n    gl.bufferData( gl.ELEMENT_ARRAY_BUFFER, elements, gl.STATIC_DRAW );\n    return buff;\n  }\n\n  function newCanvas() {\n    var body = document.body;\n    var canvas = document.createElement( \"canvas\" );\n    canvas.setAttribute( \"width\", body.clientWidth );\n    canvas.setAttribute( \"height\", body.clientHeight );\n    body.appendChild( canvas );\n    return canvas;\n  }\n\n  function showSplashScreen( applicationName ) {\n    if( typeof applicationName === 'undefined' ) applicationName = 'TOLOKOBAN';\n\n    return new Promise(function (resolve, reject) {\n      function show() {\n        var splash = document.createElement( \"div\" );\n        splash.setAttribute( \"id\", \"SPLASH\" );\n        splash.innerHTML = \"<div>\" + applicationName + \"</div><div>\" + applicationName + \"</div>\";\n        document.body.appendChild( splash );\n        var progress = document.createElement( \"div\" );\n        progress.setAttribute( \"id\", \"PROGRESS\" );\n        document.body.appendChild( progress );\n        window.setTimeout(function() {\n          splash.setAttribute( \"class\", \"show\" );\n        }, 50);\n        resolve();\n      }\n      if( document.readyState === \"complete\" ) {\n        show();\n      } else {\n        document.addEventListener( \"DOMContentLoaded\", show );\n      }\n    });\n  }\n\n  function hideSplashScreen() {\n    var splash = document.getElementById( \"SPLASH\" );\n    splash.setAttribute( \"class\", \"hide\" );\n    var progress = document.getElementById( \"PROGRESS\" );\n    document.body.removeChild( progress );\n    window.setTimeout(function() {\n      document.body.removeChild( splash );\n    }, 500);\n  }\n\n\n  //========================================================================================\n  return {\n    Program: Program,\n    fetchAssets: fetchAssets,\n    fillArrayBuffer: fillArrayBuffer,\n    fillElementBuffer: fillElementBuffer,\n    newCanvas: newCanvas\n  };\n}();\n\nexport default WebGL;\n"]},"metadata":{},"sourceType":"module"}
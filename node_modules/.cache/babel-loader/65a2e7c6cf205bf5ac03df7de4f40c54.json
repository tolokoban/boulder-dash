{"ast":null,"code":"import _classCallCheck from \"/home/tolokoban/Code/github/boulder-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/tolokoban/Code/github/boulder-dash/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport Gesture from \"../gesture\";\nimport Theme from \"../theme\";\nimport castString from \"../converter/string\";\nimport castBoolean from \"../converter/boolean\";\nimport castFunction from \"../converter/function\";\nimport \"./touchable.css\";\n\nvar Touchable =\n/*#__PURE__*/\nfunction () {\n  function Touchable(args) {\n    _classCallCheck(this, Touchable);\n\n    this._element = void 0;\n    this._enabled = true;\n    this.color = \"#000\";\n    this.accent = false;\n    this.onTap = void 0;\n    this.element = args.element;\n    this.enabled = castBoolean(args.enabled, true);\n    this.color = castString(args.color, \"\");\n    this.onTap = castFunction(args.onTap);\n  }\n\n  _createClass(Touchable, [{\n    key: \"fire\",\n    value: function fire(evt) {\n      if (!this.enabled) return;\n      var handler = this.onTap;\n\n      if (typeof handler === 'function') {\n        handler(evt);\n      }\n    }\n  }, {\n    key: \"enabled\",\n    get: function get() {\n      return this._enabled;\n    },\n    set: function set(value) {\n      this._enabled = value;\n    }\n  }, {\n    key: \"element\",\n    get: function get() {\n      return this._element;\n    },\n    set: function set(element) {\n      var that = this;\n      if (typeof element === 'undefined') return;\n      Gesture(element).on({\n        keydown: function keydown(evt) {\n          if (!that.enabled) return;\n          var key = evt.key;\n\n          if (key === \" \" || key === \"Enter\") {\n            evt.preventDefault();\n            evt.stopPropagation();\n            that.fire();\n          }\n        },\n        down: function down(evt) {\n          if (!that.enabled) return;\n        },\n        up: function up(evt) {\n          if (!that.removeTouchDisk) return;\n          that.removeTouchDisk();\n          delete that.removeTouchDisk;\n        },\n        tap: function tap(evt) {\n          if (!that.enabled) return;\n          that.fire(evt);\n          var rect = element.getBoundingClientRect();\n          var style = window.getComputedStyle(element);\n          var screen = createScreen(rect);\n          screen.style.borderRadius = style.getPropertyValue(\"border-radius\");\n          var x = evt.x || 0;\n          var y = evt.y || 0;\n          var w = Math.max(x, rect.width - x);\n          var h = Math.max(y, rect.height - y);\n          var radius = Math.ceil(1.1 * Math.sqrt(w * w + h * h));\n          var ripple = document.createElement(\"div\");\n          screen.appendChild(ripple);\n          ripple.style.left = \"\".concat(x - radius, \"px\");\n          ripple.style.top = \"\".concat(y - radius, \"px\");\n          ripple.style.width = \"\".concat(2 * radius, \"px\");\n          ripple.style.height = \"\".concat(2 * radius, \"px\");\n\n          if (that.color.length > 0) {\n            ripple.style.background = that.color;\n          } else {\n            ripple.style.background = Theme.isDark() ? \"#fff\" : \"#000\";\n          }\n\n          window.setTimeout(function () {\n            return ripple.className = \"open\";\n          });\n          window.setTimeout(function () {\n            return document.body.removeChild(screen);\n          }, 500);\n        }\n      });\n    }\n  }]);\n\n  return Touchable;\n}();\n\nexport { Touchable as default };\n\nfunction createScreen(rect) {\n  var div = document.createElement(\"div\");\n  div.className = \"tfw-behavior-touchable\";\n  div.style.left = \"\".concat(rect.left, \"px\");\n  div.style.top = \"\".concat(rect.top, \"px\");\n  div.style.width = \"\".concat(rect.width, \"px\");\n  div.style.height = \"\".concat(rect.height, \"px\");\n  document.body.appendChild(div);\n  return div;\n}","map":{"version":3,"sources":["/home/tolokoban/Code/github/boulder-dash/src/tfw/behavior/touchable.ts"],"names":["Gesture","Theme","castString","castBoolean","castFunction","Touchable","args","_element","_enabled","color","accent","onTap","element","enabled","evt","handler","value","that","on","keydown","key","preventDefault","stopPropagation","fire","down","up","removeTouchDisk","tap","rect","getBoundingClientRect","style","window","getComputedStyle","screen","createScreen","borderRadius","getPropertyValue","x","y","w","Math","max","width","h","height","radius","ceil","sqrt","ripple","document","createElement","appendChild","left","top","length","background","isDark","setTimeout","className","body","removeChild","div"],"mappings":"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","sourcesContent":["import Gesture from \"../gesture\"\nimport Theme from \"../theme\"\nimport castString from \"../converter/string\"\nimport castBoolean from \"../converter/boolean\"\nimport castFunction from \"../converter/function\"\nimport \"./touchable.css\"\n\ninterface IArgs {\n    element?: HTMLElement;\n    enabled?: boolean;\n    color?: string;\n    onTap?: () => void;\n}\n\ninterface IRect {\n    left: number;\n    top: number;\n    width: number;\n    height: number;\n}\n\nexport default class Touchable {\n    _element: HTMLElement | undefined;\n    _enabled: boolean = true;\n    color: string = \"#000\";\n    accent: boolean = false;\n    onTap: () => void;\n\n    constructor(args: IArgs) {\n        this.element = args.element;\n        this.enabled = castBoolean(args.enabled, true);\n        this.color = castString(args.color, \"\");\n        this.onTap = castFunction(args.onTap);\n    }\n\n    fire(evt) {\n        if (!this.enabled) return;\n\n        const handler = this.onTap;\n        if (typeof handler === 'function') {\n            handler(evt);\n        }\n    }\n\n    get enabled() { return this._enabled; }\n    set enabled(value: boolean) { this._enabled = value; }\n\n    get element() { return this._element; }\n    set element(element: HTMLElement | undefined) {\n        const that = this;\n        if (typeof element === 'undefined') return;\n        Gesture(element).on({\n            keydown(evt) {\n                if (!that.enabled) return;\n\n                const key = evt.key;\n                if (key === \" \" || key === \"Enter\") {\n                    evt.preventDefault();\n                    evt.stopPropagation();\n                    that.fire();\n                }\n            },\n\n            down(evt) {\n                if (!that.enabled) return;\n            },\n\n            up(evt) {\n                if (!that.removeTouchDisk) return;\n                that.removeTouchDisk();\n                delete that.removeTouchDisk;\n            },\n\n            tap(evt) {\n                if (!that.enabled) return;\n                that.fire(evt);\n\n                const rect = element.getBoundingClientRect();\n                const style = window.getComputedStyle(element);\n                const screen = createScreen(rect);\n                screen.style.borderRadius = style.getPropertyValue(\"border-radius\");\n                const x = evt.x || 0;\n                const y = evt.y || 0;\n                const w = Math.max(x, rect.width - x);\n                const h = Math.max(y, rect.height - y);\n                const radius = Math.ceil(1.1 * Math.sqrt(w * w + h * h));\n                const ripple = document.createElement(\"div\");\n                screen.appendChild(ripple);\n                ripple.style.left = `${x - radius}px`;\n                ripple.style.top = `${y - radius}px`;\n                ripple.style.width = `${2 * radius}px`;\n                ripple.style.height = `${2 * radius}px`;\n                if (that.color.length > 0) {\n                    ripple.style.background = that.color;\n                } else {\n                    ripple.style.background = Theme.isDark() ? \"#fff\" : \"#000\";\n                }\n                window.setTimeout(() => ripple.className = \"open\");\n                window.setTimeout(() => document.body.removeChild(screen), 500);\n            }\n        })\n    }\n}\n\n\nfunction createScreen(rect: IRect) {\n    const div = document.createElement(\"div\");\n    div.className = \"tfw-behavior-touchable\";\n    div.style.left = `${rect.left}px`;\n    div.style.top = `${rect.top}px`;\n    div.style.width = `${rect.width}px`;\n    div.style.height = `${rect.height}px`;\n    document.body.appendChild(div);\n    return div;\n}\n"]},"metadata":{},"sourceType":"module"}